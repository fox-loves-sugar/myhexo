<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="常记Fifty, 狐狸大大爱吃糖的博客">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>常记Fifty | 狐狸大大爱吃糖的博客</title>
    <link rel="icon" type="image/png" href="/myhexo/favicon.png">

    <link rel="stylesheet" type="text/css" href="/myhexo/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/myhexo/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/myhexo/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/myhexo/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/myhexo/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/myhexo/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/myhexo/css/my.css">

    <script src="/myhexo/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/myhexo/atom.xml" title="狐狸大大爱吃糖的博客" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/myhexo/" class="waves-effect waves-light">
                    
                    <img src="/myhexo/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">狐狸大大爱吃糖的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/myhexo/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/myhexo/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="http://www.baidu.com" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>Baidu</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="http://www.qq.com" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>QQ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="http://www.qqmusic.com" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Mus</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/myhexo/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">狐狸大大爱吃糖的博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/myhexo/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/myhexo/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="http://www.baidu.com" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			Baidu
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="http://www.qq.com" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			QQ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="http://www.qqmusic.com" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Mus
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://gitee.com/foxes_love_sugar" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://gitee.com/foxes_love_sugar" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/myhexo/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">常记Fifty</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/myhexo/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/myhexo/tags/docker/">
                                <span class="chip bg-color">docker</span>
                            </a>
                        
                            <a href="/myhexo/tags/python/">
                                <span class="chip bg-color">python</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-02-01
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="1-linux查看端口命令"><a href="#1-linux查看端口命令" class="headerlink" title="1 linux查看端口命令"></a>1 linux查看端口命令</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntlp   			<span class="comment"># 查看当前所有tcp端口</span></span><br><span class="line"></span><br><span class="line">netstat -ntulp |grep <span class="number">80</span>   	<span class="comment"># 查看所有80端口使用情况</span></span><br><span class="line"></span><br><span class="line">netstat -an | grep <span class="number">3306</span>   	<span class="comment"># 查看所有3306端口使用情况</span></span><br><span class="line"></span><br><span class="line">kill <span class="number">-9</span> <span class="number">3306</span>				<span class="comment"># 杀死使用3306端口的进程</span></span><br></pre></td></tr></table></figure>

<h3 id="2-ModelViewSet-路由"><a href="#2-ModelViewSet-路由" class="headerlink" title="2 ModelViewSet 路由"></a>2 ModelViewSet 路由</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = DefaultRouter()</span><br><span class="line">router.register(<span class="string">r&#x27;user&#x27;</span>, views.UserViewSet)</span><br><span class="line"></span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>

<h3 id="3-Vue模块安装错误"><a href="#3-Vue模块安装错误" class="headerlink" title="3 Vue模块安装错误"></a>3 Vue模块安装错误</h3><h4 id="3-1-出现问题"><a href="#3-1-出现问题" class="headerlink" title="3.1 出现问题"></a>3.1 出现问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">94% asset optimization</span><br><span class="line">ERROR  Failed to compile with 2 errors                                                                         19:47:42</span><br><span class="line"></span><br><span class="line">These dependencies were not found:</span><br><span class="line"></span><br><span class="line">* babel-runtime&#x2F;core-js&#x2F;json&#x2F;stringify in .&#x2F;src&#x2F;http&#x2F;index.js</span><br><span class="line">* babel-runtime&#x2F;core-js&#x2F;promise in .&#x2F;src&#x2F;http&#x2F;index.js</span><br><span class="line"></span><br><span class="line">To install them, you can run: npm install --save babel-runtime&#x2F;core-js&#x2F;json&#x2F;stringify babel-runtime&#x2F;core-js&#x2F;promise</span><br></pre></td></tr></table></figure>

<h4 id="3-2-解决方案"><a href="#3-2-解决方案" class="headerlink" title="3.2 解决方案"></a>3.2 解决方案</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 提示</span><br><span class="line">&#x2F;&#x2F; 分别安装几个包，就可以解决了！</span><br><span class="line">&gt;cnpm install --save babel-runtime</span><br><span class="line">&gt;cnpm install --save core-js</span><br><span class="line">&gt;cnpm install --save json</span><br><span class="line">&gt;cnpm install --save stringify</span><br></pre></td></tr></table></figure>

<h3 id="4-Serializer修改数据"><a href="#4-Serializer修改数据" class="headerlink" title="4 Serializer修改数据"></a>4 Serializer修改数据</h3><h4 id="4-1-models-py"><a href="#4-1-models-py" class="headerlink" title="4.1 models.py"></a>4.1 models.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    publish = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    read_num = models.IntegerField()  <span class="comment"># 阅读量</span></span><br><span class="line">    comment_num = models.IntegerField()  <span class="comment"># 评论量</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;tb_books&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>

<h4 id="4-2-serializer-py"><a href="#4-2-serializer-py" class="headerlink" title="4.2 serializer.py"></a>4.2 serializer.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksModelSer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Books</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-views-py"><a href="#4-3-views-py" class="headerlink" title="4.3 views.py"></a>4.3 views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        print(request.data)</span><br><span class="line">        <span class="built_in">id</span> = request.data.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">        books_obj = Books.objects.get(<span class="built_in">id</span>=<span class="built_in">id</span>)</span><br><span class="line">        books_ser = BooksModelSer(data=request.data,instance=books_obj)</span><br><span class="line">        books_ser.is_valid()</span><br><span class="line">        books_ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;ok&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="4-4-urls-py"><a href="#4-4-urls-py" class="headerlink" title="4.4 urls.py"></a>4.4 urls.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;books/&#x27;</span>,BooksView.as_view())</span><br></pre></td></tr></table></figure>

<h3 id="5-element-ui-安装命令"><a href="#5-element-ui-安装命令" class="headerlink" title="5 element-ui 安装命令"></a>5 element-ui 安装命令</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i element-ui -S</span><br></pre></td></tr></table></figure>

<h3 id="6-json获取request的数据"><a href="#6-json获取request的数据" class="headerlink" title="6 json获取request的数据"></a>6 json获取request的数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">body_json = request.body.decode()</span><br><span class="line">body_dict = json.loads(body_json)</span><br></pre></td></tr></table></figure>

<h3 id="7-跨域后端"><a href="#7-跨域后端" class="headerlink" title="7 跨域后端"></a>7 跨域后端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">	<span class="string">&#x27;corsheaders&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="8-跨域前端"><a href="#8-跨域前端" class="headerlink" title="8 跨域前端"></a>8 跨域前端</h3><h4 id="8-1-http-js"><a href="#8-1-http-js" class="headerlink" title="8.1 http.js"></a>8.1 http.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一步：设置axios</span></span><br><span class="line">axios.defaults.baseURL = <span class="string">&quot;http://192.168.56.100:1594/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//全局设置网络超时</span></span><br><span class="line">axios.defaults.timeout = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置请求头信息</span></span><br><span class="line">axios.defaults.headers.post[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span>;</span><br><span class="line">axios.defaults.headers.put[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二：设置拦截器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求拦截器(当前端发送请求给后端前进行拦截)</span></span><br><span class="line"><span class="comment"> * 例1：请求拦截器获取token设置到axios请求头中，所有请求接口都具有这个功能</span></span><br><span class="line"><span class="comment"> * 例2：到用户访问某一个页面，但是用户没有登录，前端页面自动跳转 /login/ 页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">    config =&gt; &#123;</span><br><span class="line">        <span class="comment">// 每次发送请求之前判断是否存在token，如果存在，则统一在http请求的header都加上token，不用每次请求都手动添加了</span></span><br><span class="line">        <span class="keyword">const</span> token = <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">            <span class="comment">// console.log(token)</span></span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            config.headers.Authorization = <span class="string">&#x27;JWT &#x27;</span> + token</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.error(error);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">    <span class="comment">// 请求成功</span></span><br><span class="line">    res =&gt; res.status === <span class="number">200</span> ? <span class="built_in">Promise</span>.resolve(res) : <span class="built_in">Promise</span>.reject(res),</span><br><span class="line">    <span class="comment">// 请求失败</span></span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (error.response) &#123;</span><br><span class="line">            <span class="comment">// 判断一下返回结果的status == 401？  ==401跳转登录页面。  ！=401passs</span></span><br><span class="line">            <span class="comment">// console.log(error.response)</span></span><br><span class="line">            <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">                <span class="comment">// 跳转不可以使用this.$router.push方法、</span></span><br><span class="line">                <span class="comment">// this.$router.push(&#123;path:&#x27;/login&#x27;&#125;)</span></span><br><span class="line">                <span class="built_in">window</span>.location.href = <span class="string">&quot;http://127.0.0.1:8888/&quot;</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// errorHandle(response.status, response.data.message);</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 请求已发出，但是不在2xx的范围</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 处理断网的情况</span></span><br><span class="line">            <span class="comment">// eg:请求超时或断网时，更新state的network状态</span></span><br><span class="line">            <span class="comment">// network状态在app.vue中控制着一个全局的断网提示组件的显示隐藏</span></span><br><span class="line">            <span class="comment">// 关于断网组件中的刷新重新获取数据，会在断网组件中说明</span></span><br><span class="line">            <span class="comment">// store.commit(&#x27;changeNetwork&#x27;, false);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三：封装axios请求</span></span><br><span class="line"><span class="comment">// 3.1 封装get请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_get</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve, reject) =&gt; &#123;</span><br><span class="line">            axios.get(url, &#123;<span class="attr">params</span>:params&#125;)</span><br><span class="line">                .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// console.log(&quot;封装信息的的res&quot;, res)</span></span><br><span class="line">                    resolve(res.data)</span><br><span class="line">                &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    reject(err.data)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.2 封装post请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_post</span>(<span class="params">url, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve, reject) =&gt; &#123;</span><br><span class="line">            <span class="comment">// console.log(data)</span></span><br><span class="line">            axios.post(url, <span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">                .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// console.log(&quot;封装信息的的res&quot;, res)</span></span><br><span class="line">                    resolve(res.data)</span><br><span class="line">                &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    reject(err.data)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.3 封装put请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_put</span>(<span class="params">url, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve, reject) =&gt; &#123;</span><br><span class="line">            <span class="comment">// console.log(data)</span></span><br><span class="line">            axios.put(url, <span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">                .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// console.log(&quot;封装信息的的res&quot;, res)</span></span><br><span class="line">                    resolve(res.data)</span><br><span class="line">                &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    reject(err.data)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.4 封装delete请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_delete</span>(<span class="params">url, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve, reject) =&gt; &#123;</span><br><span class="line">            <span class="comment">// console.log(data)</span></span><br><span class="line">            axios.delete(url, &#123; <span class="attr">params</span>: data &#125;)</span><br><span class="line">                .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// console.log(&quot;封装信息的的res&quot;, res)</span></span><br><span class="line">                    resolve(res.data)</span><br><span class="line">                &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    reject(err.data)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8-2-apis-js"><a href="#8-2-apis-js" class="headerlink" title="8.2 apis.js"></a>8.2 apis.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将我们http.js中封装好的  get,post.put,delete  导过来</span></span><br><span class="line"><span class="keyword">import</span> &#123; axios_get, axios_post, axios_delete, axios_put &#125; <span class="keyword">from</span> <span class="string">&#x27;./index.js&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 书籍管理接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBookList = <span class="function">(<span class="params">params, headers</span>) =&gt;</span> axios_get(<span class="string">&quot;/books/book/&quot;</span>, params, headers)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addBook = <span class="function">(<span class="params">params, headers</span>) =&gt;</span> axios_post(<span class="string">&quot;/books/book/&quot;</span>, params, headers)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateBook = <span class="function">(<span class="params">params, headers</span>) =&gt;</span> axios_put(<span class="string">&quot;/books/book/&quot;</span>, params, headers)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> delBook = <span class="function">(<span class="params">params, headers</span>) =&gt;</span> axios_delete(<span class="string">&quot;/books/book/&quot;</span>, params, headers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//按照格式确定方法名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> user_login = <span class="function"><span class="params">p</span> =&gt;</span> axios_post(<span class="string">&quot;/user/login/&quot;</span>, p)  <span class="comment">//</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> get_dept_list = <span class="function"><span class="params">p</span> =&gt;</span> axios_get(<span class="string">&quot;/account/deptManage/&quot;</span>, p)  <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<h3 id="9-继承AbstractUser"><a href="#9-继承AbstractUser" class="headerlink" title="9 继承AbstractUser"></a>9 继承AbstractUser</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;user.User&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">AbstractUser</span>):</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">30</span>, unique=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="10-settings-配置"><a href="#10-settings-配置" class="headerlink" title="10 settings 配置"></a>10 settings 配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Django settings for opwf project.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generated by &#x27;django-admin startproject&#x27; using Django 2.0.13.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information on this file, see</span></span><br><span class="line"><span class="string">https://docs.djangoproject.com/en/2.0/topics/settings/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For the full list of settings and their values, see</span></span><br><span class="line"><span class="string">https://docs.djangoproject.com/en/2.0/ref/settings/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>, os.path.join(BASE_DIR, <span class="string">&#x27;apps&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Quick-start development settings - unsuitable for production</span></span><br><span class="line"><span class="comment"># See https://docs.djangoproject.com/en/2.0/howto/deployment/checklist/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SECURITY WARNING: keep the secret key used in production secret!</span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;uorj1ni^mnut@wo@c%)iv)%5=8dxlml4-j0!f3b%4#f*8a5)3t&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SECURITY WARNING: don&#x27;t run with debug turned on in production!</span></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Application definition</span></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user.apps.UserConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;workflow.apps.WorkflowConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;workerorder.apps.WorkerorderConfig&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;jwt&#x27;,</span></span><br><span class="line">    <span class="comment"># &#x27;rest_framework_jwt&#x27;,</span></span><br><span class="line">    <span class="comment"># &#x27;rest_framework.authentication&#x27;</span></span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ROOT_URLCONF = <span class="string">&#x27;opwf.urls&#x27;</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">WSGI_APPLICATION = <span class="string">&#x27;opwf.wsgi.application&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Database</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/ref/settings/#databases</span></span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;opwf_db&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Password validation</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/ref/settings/#auth-password-validators</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 文档报错： AttributeError: ‘AutoSchema’ object has no attribute ‘get_link’</span></span><br><span class="line">    <span class="comment"># 用下面的设置可以解决</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.schemas.AutoSchema&#x27;</span>,</span><br><span class="line">    <span class="comment"># 默认设置是:</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_SCHEMA_CLASS&#x27;: &#x27;rest_framework.schemas.openapi.AutoSchema&#x27;,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 异常处理器</span></span><br><span class="line">    <span class="comment"># &#x27;EXCEPTION_HANDLER&#x27;: &#x27;user.utils.exception_handler&#x27;,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Base API policies    　　默认渲染器类</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 默认解析器类</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 1.认证器（全局）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;</span>,  <span class="comment"># 在 DRF中配置JWT认证</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.authentication.SessionAuthentication&#x27;,  # 使用session时的认证器</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.authentication.BasicAuthentication&#x27;  # 提交表单时的认证器</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.权限配置（全局）： 顺序靠上的严格</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAdminUser&#x27;,  # 管理员可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticated&#x27;,  # 认证用户可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticatedOrReadOnly&#x27;,  # 认证用户可以访问, 否则只能读取</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.permissions.AllowAny&#x27;</span>,  <span class="comment"># 所有用户都可以访问</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 3.限流（防爬虫）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 3.1限流策略</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;</span></span><br><span class="line">    <span class="comment">#     &#x27;user&#x27;: &#x27;100/hour&#x27;,  # 认证用户每小时100次</span></span><br><span class="line">    <span class="comment">#     &#x27;anon&#x27;: &#x27;300/day&#x27;,  # 未认证用户每天能访问3次</span></span><br><span class="line">    <span class="comment"># &#125;,</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;DEFAULT_CONTENT_NEGOTIATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.negotiation.DefaultContentNegotiation&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_METADATA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.metadata.SimpleMetadata&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSIONING_CLASS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.分页（全局）：全局分页器, 例如 省市区的数据自定义分页器, 不需要分页</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_PAGINATION_CLASS&#x27;: &#x27;rest_framework.pagination.PageNumberPagination&#x27;,</span></span><br><span class="line">    <span class="comment"># 每页返回数量</span></span><br><span class="line">    <span class="comment"># &#x27;PAGE_SIZE&#x27;: 1</span></span><br><span class="line">    <span class="comment"># 5.过滤器后端</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;django_filters.rest_framework.backends.DjangoFilterBackend&#x27;, 包路径有变化</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.1过滤排序（全局）：Filtering 过滤排序</span></span><br><span class="line">    <span class="string">&#x27;SEARCH_PARAM&#x27;</span>: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ORDERING_PARAM&#x27;</span>: <span class="string">&#x27;ordering&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NUM_PROXIES&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.版本控制：Versioning  接口版本控制</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSION&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;ALLOWED_VERSIONS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;VERSION_PARAM&#x27;</span>: <span class="string">&#x27;version&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Authentication  认证</span></span><br><span class="line">    <span class="comment"># 未认证用户使用的用户类型</span></span><br><span class="line">    <span class="string">&#x27;UNAUTHENTICATED_USER&#x27;</span>: <span class="string">&#x27;django.contrib.auth.models.AnonymousUser&#x27;</span>,</span><br><span class="line">    <span class="comment"># 未认证用户使用的Token值</span></span><br><span class="line">    <span class="string">&#x27;UNAUTHENTICATED_TOKEN&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># View configuration</span></span><br><span class="line">    <span class="string">&#x27;VIEW_NAME_FUNCTION&#x27;</span>: <span class="string">&#x27;rest_framework.views.get_view_name&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;VIEW_DESCRIPTION_FUNCTION&#x27;</span>: <span class="string">&#x27;rest_framework.views.get_view_description&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NON_FIELD_ERRORS_KEY&#x27;</span>: <span class="string">&#x27;non_field_errors&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Testing</span></span><br><span class="line">    <span class="string">&#x27;TEST_REQUEST_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.MultiPartRenderer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;TEST_REQUEST_DEFAULT_FORMAT&#x27;</span>: <span class="string">&#x27;multipart&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Hyperlink settings</span></span><br><span class="line">    <span class="string">&#x27;URL_FORMAT_OVERRIDE&#x27;</span>: <span class="string">&#x27;format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;FORMAT_SUFFIX_KWARG&#x27;</span>: <span class="string">&#x27;format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;URL_FIELD_NAME&#x27;</span>: <span class="string">&#x27;url&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Encoding</span></span><br><span class="line">    <span class="string">&#x27;UNICODE_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;COMPACT_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;STRICT_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;COERCE_DECIMAL_TO_STRING&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;UPLOADED_FILES_USE_URL&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Browseable API</span></span><br><span class="line">    <span class="string">&#x27;HTML_SELECT_CUTOFF&#x27;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="string">&#x27;HTML_SELECT_CUTOFF_TEXT&#x27;</span>: <span class="string">&quot;More than &#123;count&#125; items...&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Schemas</span></span><br><span class="line">    <span class="string">&#x27;SCHEMA_COERCE_PATH_PK&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;SCHEMA_COERCE_METHOD_NAMES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;retrieve&#x27;</span>: <span class="string">&#x27;read&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;destroy&#x27;</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x27;Access-Control-Allow-Origin&#x27;:&#x27;http://localhost:8080&#x27;,</span></span><br><span class="line">    <span class="comment"># &#x27;Access-Control-Allow-Credentials&#x27;: True</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AUTH_PASSWORD_VALIDATORS = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.MinimumLengthValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.CommonPasswordValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.NumericPasswordValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Internationalization</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/topics/i18n/</span></span><br><span class="line"></span><br><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">USE_L10N = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Static files (CSS, JavaScript, Images)</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/howto/static-files/</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;user.User&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jwt载荷中的有效期设置</span></span><br><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    <span class="comment"># 1.token前缀：headers中 Authorization 值的前缀</span></span><br><span class="line">    <span class="string">&#x27;JWT_AUTH_HEADER_PREFIX&#x27;</span>: <span class="string">&#x27;JWT&#x27;</span>,</span><br><span class="line">    <span class="comment"># 2.token有效期：一天有效</span></span><br><span class="line">    <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">1</span>),</span><br><span class="line">    <span class="comment"># 3.刷新token：允许使用旧的token换新token</span></span><br><span class="line">    <span class="string">&#x27;JWT_ALLOW_REFRESH&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># 4.token有效期：token在24小时内过期, 可续期token</span></span><br><span class="line">    <span class="string">&#x27;JWT_REFRESH_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(hours=<span class="number">24</span>),</span><br><span class="line">    <span class="comment"># 5.自定义JWT载荷信息：自定义返回格式，需要手工创建</span></span><br><span class="line">    <span class="string">&#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;</span>: <span class="string">&#x27;user.utils.jwt_response_payload_handler&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-几个容易混淆的导包"><a href="#11-几个容易混淆的导包" class="headerlink" title="11 几个容易混淆的导包"></a>11 几个容易混淆的导包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ModelViewSet</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"></span><br><span class="line"><span class="comment"># APIView</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="comment"># Serializer</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="comment"># DefaultRouter</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"></span><br><span class="line"><span class="comment"># AbstractUser</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br></pre></td></tr></table></figure>

<h3 id="12-ModelViewSet-路由三部曲"><a href="#12-ModelViewSet-路由三部曲" class="headerlink" title="12 ModelViewSet 路由三部曲"></a>12 ModelViewSet 路由三部曲</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = DefaultRouter()</span><br><span class="line">router.register(<span class="string">r&#x27;user&#x27;</span>, views.UserViewSet)</span><br><span class="line"></span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>

<h3 id="13-路由转换器"><a href="#13-路由转换器" class="headerlink" title="13 路由转换器"></a>13 路由转换器</h3><ul>
<li>我们在定义一个标准路由的时候，可以给路由定义一些可变的参数，这些参数会传递给我们的视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> userapp.views <span class="keyword">import</span> findgoods,findlove</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;goods/&lt;int:id&gt;/&#x27;</span>, findgoods),</span><br><span class="line">    path(<span class="string">&#x27;goods/&lt;str:name&gt;/&#x27;</span>, findlove)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">路由转换器：</span><br><span class="line">我们可以在参数部分写一个转换器，参数值在传递到视图函数之前，对参数进行格式转换，默认我们的参数值都是字符串<span class="built_in">str</span>格式，如果我们想把参数值转成整型，我们可以使用<span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line">goods_list=[<span class="string">&#x27;苹果手机&#x27;</span>,<span class="string">&#x27;联想电脑&#x27;</span>,<span class="string">&#x27;大西瓜&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findgoods</span>(<span class="params">request, <span class="built_in">id</span></span>):</span></span><br><span class="line">    print(<span class="built_in">id</span>, <span class="built_in">type</span>(<span class="built_in">id</span>))</span><br><span class="line">    name = goods_list[<span class="built_in">id</span>]</span><br><span class="line">    <span class="keyword">return</span>  HttpResponse(<span class="string">&quot;查找商品：&quot;</span>+name)</span><br></pre></td></tr></table></figure>

<h3 id="14-状态码大全"><a href="#14-状态码大全" class="headerlink" title="14 状态码大全"></a>14 状态码大全</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">* http状态返回代码 <span class="number">1</span>xx（临时响应）</span><br><span class="line">    表示临时响应并需要请求者继续执行操作的状态代码。</span><br><span class="line">代码说明：</span><br><span class="line"><span class="number">100</span>   （继续）请求者应当继续提出请求。服务器返回此代码表示已收到请求的第一部分，正在等待其余部分。</span><br><span class="line"><span class="number">101</span>   （切换协议）请求者已要求服务器切换协议，服务器已确认并准备切换。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">** http状态返回代码</span><br><span class="line">    <span class="number">2</span>xx （成功）表示成功处理了请求的状态代码。</span><br><span class="line">代码说明：</span><br><span class="line"><span class="number">200</span>   （成功）  服务器已成功处理了请求。通常，这表示服务器提供了请求的网页。</span><br><span class="line"><span class="number">201</span>   （已创建）  请求成功并且服务器创建了新的资源。</span><br><span class="line"><span class="number">202</span>   （已接受）  服务器已接受请求，但尚未处理。</span><br><span class="line"><span class="number">203</span>   （非授权信息）  服务器已成功处理了请求，但返回的信息可能来自另一来源。</span><br><span class="line"><span class="number">204</span>   （无内容）  服务器成功处理了请求，但没有返回任何内容。</span><br><span class="line"><span class="number">205</span>   （重置内容）服务器成功处理了请求，但没有返回任何内容。</span><br><span class="line"><span class="number">206</span>   （部分内容）  服务器成功处理了部分 GET 请求。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** http状态返回代码 <span class="number">3</span>xx （重定向）</span><br><span class="line">    表示要完成请求，需要进一步操作。通常，这些状态代码用来重定向。</span><br><span class="line">代码说明：</span><br><span class="line"><span class="number">300</span>   （多种选择）  针对请求，服务器可执行多种操作。服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择。</span><br><span class="line"><span class="number">301</span>   （永久移动）  请求的网页已永久移动到新位置。服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。</span><br><span class="line"><span class="number">302</span>   （临时移动）  服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。</span><br><span class="line"><span class="number">303</span>   （查看其他位置）请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">304</span>   （未修改）自从上次请求后，请求的网页未修改过。服务器返回此响应时，不会返回网页内容。</span><br><span class="line"><span class="number">305</span>   （使用代理）请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理。</span><br><span class="line"><span class="number">307</span>   （临时重定向）  服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**** http状态返回代码 <span class="number">4</span>xx（请求错误）</span><br><span class="line">    这些状态代码表示请求可能出错，妨碍了服务器的处理。</span><br><span class="line">代码说明：</span><br><span class="line"><span class="number">400</span>   （错误请求）服务器不理解请求的语法。</span><br><span class="line"><span class="number">401</span>   （未授权）请求要求身份验证。对于需要登录的网页，服务器可能返回此响应。</span><br><span class="line"><span class="number">403</span>   （禁止）服务器拒绝请求。</span><br><span class="line"><span class="number">404</span>   （未找到）服务器找不到请求的网页。</span><br><span class="line"><span class="number">405</span>   （方法禁用）禁用请求中指定的方法。</span><br><span class="line"><span class="number">406</span>   （不接受）无法使用请求的内容特性响应请求的网页。</span><br><span class="line"><span class="number">407</span>   （需要代理授权）此状态代码与 <span class="number">401</span>（未授权）类似，但指定请求者应当授权使用代理。</span><br><span class="line"><span class="number">408</span>   （请求超时）  服务器等候请求时发生超时。</span><br><span class="line"><span class="number">409</span>   （冲突）  服务器在完成请求时发生冲突。服务器必须在响应中包含有关冲突的信息。</span><br><span class="line"><span class="number">410</span>   （已删除）  如果请求的资源已永久删除，服务器就会返回此响应。</span><br><span class="line"><span class="number">411</span>   （需要有效长度）服务器不接受不含有效内容长度标头字段的请求。</span><br><span class="line"><span class="number">412</span>   （未满足前提条件）服务器未满足请求者在请求中设置的其中一个前提条件。</span><br><span class="line"><span class="number">413</span>   （请求实体过大）服务器无法处理请求，因为请求实体过大，超出服务器的处理能力。</span><br><span class="line"><span class="number">414</span>   （请求的 URI 过长）请求的 URI（通常为网址）过长，服务器无法处理。</span><br><span class="line"><span class="number">415</span>   （不支持的媒体类型）请求的格式不受请求页面的支持。</span><br><span class="line"><span class="number">416</span>   （请求范围不符合要求）如果页面无法提供请求的范围，则服务器会返回此状态代码。</span><br><span class="line"><span class="number">417</span>   （未满足期望值）服务器未满足<span class="string">&quot;期望&quot;</span>请求标头字段的要求。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***** http状态返回代码 <span class="number">5</span>xx（服务器错误）</span><br><span class="line">    这些状态代码表示服务器在尝试处理请求时发生内部错误。这些错误可能是服务器本身的错误，而不是请求出错。</span><br><span class="line">代码说明：</span><br><span class="line"><span class="number">500</span>   （服务器内部错误）  服务器遇到错误，无法完成请求。</span><br><span class="line">从上往下读，最上面都是抛出异常代码，从上往下，慢慢找出错误产生的原生地方，一般都是最下面是错误出现的地方</span><br><span class="line"></span><br><span class="line"><span class="number">501</span>   （尚未实施）服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码。</span><br><span class="line"><span class="number">502</span>   （错误网关）服务器作为网关或代理，从上游服务器收到无效响应。</span><br><span class="line"><span class="number">503</span>   （服务不可用）服务器目前无法使用（由于超载或停机维护）。通常，这只是暂时状态。</span><br><span class="line"><span class="number">504</span>   （网关超时）  服务器作为网关或代理，但是没有及时从上游服务器收到请求。</span><br><span class="line"><span class="number">505</span>   （HTTP 版本不受支持）服务器不支持请求中所用的 HTTP 协议版本。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">一些常见的http状态返回代码为：</span><br><span class="line"><span class="number">200</span> - 服务器成功返回网页</span><br><span class="line"><span class="number">404</span> - 请求的网页不存在</span><br><span class="line"><span class="number">503</span> - 服务不可用</span><br></pre></td></tr></table></figure>

<h3 id="15-请求报文"><a href="#15-请求报文" class="headerlink" title="15 请求报文"></a>15 请求报文</h3><p><img src=".%5Cimgs%5Cimage-20201123075848880.png" alt="image-20201123075848880"></p>
<h3 id="16-响应报文"><a href="#16-响应报文" class="headerlink" title="16 响应报文"></a>16 响应报文</h3><p><img src=".%5Cimgs%5Cimage-20201123080742883.png" alt="image-20201123080742883"></p>
<h3 id="17-json数据结构与使用方法"><a href="#17-json数据结构与使用方法" class="headerlink" title="17 json数据结构与使用方法"></a>17 json数据结构与使用方法</h3><h4 id="17-1-json的数据结构"><a href="#17-1-json的数据结构" class="headerlink" title="17.1  json的数据结构"></a>17.1  json的数据结构</h4><p>json全称: “JavaScript Object Notation”,(JavaScript对象表示法),一种基于文本,独立于语言的轻量级数据交换格式。</p>
<h4 id="17-2-JSON规定的格式"><a href="#17-2-JSON规定的格式" class="headerlink" title="17.2 JSON规定的格式"></a>17.2 JSON规定的格式</h4><p>​    1)数据在键值对中</p>
<p>​    2)数据由逗号分隔              </p>
<p>​    3)花括号保存对象               </p>
<p>​    4)方括号保存数组</p>
<ul>
<li>在我们python中，就认为成字典+列表组成就是我们的JSON</li>
</ul>
<h4 id="17-3-json数据的页面响应"><a href="#17-3-json数据的页面响应" class="headerlink" title="17.3 json数据的页面响应"></a>17.3 json数据的页面响应</h4><ul>
<li>JsonResponse响应json数据</li>
</ul>
<p>要想返回json数据，就要使用专门的Response对象JSONResponse</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line">方法<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">student</span>(<span class="params">requset</span>):</span></span><br><span class="line">    stu = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&quot;maple&quot;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">12</span>, <span class="string">&#x27;爱好&#x27;</span>: <span class="string">&#x27;学习&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(stu,json_dumps_params=&#123;<span class="string">&#x27;ensure_ascii&#x27;</span>:<span class="literal">False</span>&#125;)</span><br><span class="line">    <span class="comment"># 只能添加字典</span></span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">方法<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">student</span>(<span class="params">request</span>):</span></span><br><span class="line">    stu = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&quot;maple&quot;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">12</span>, <span class="string">&#x27;爱好&#x27;</span>: <span class="string">&#x27;学习&#x27;</span>&#125;</span><br><span class="line">    s = json.dumps(stu, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(s)</span><br></pre></td></tr></table></figure>

<ul>
<li>json是一个模块，可以把字典对象变成json字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># 我们进行网络传输，必须是字符串或者是二进制数据</span></span><br><span class="line"><span class="comment"># 使用python内置的json模块来完成</span></span><br><span class="line"></span><br><span class="line">stu = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&quot;maple&quot;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">12</span>, <span class="string">&#x27;爱好&#x27;</span>: <span class="string">&#x27;学习&#x27;</span>&#125;</span><br><span class="line">print(<span class="built_in">type</span>(stu))</span><br><span class="line">x = json.dumps(stu)</span><br><span class="line">print(x)</span><br><span class="line"><span class="comment"># \u 是unicode码值</span></span><br><span class="line">y = json.dumps(stu,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">print(y)</span><br><span class="line"></span><br><span class="line">c = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Marry&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">12</span>&#125;</span><br><span class="line"></span><br><span class="line">e = json.dumps(c)</span><br><span class="line">print(e, <span class="built_in">type</span>(e))		<span class="comment"># &#123;&quot;name&quot;: &quot;Marry&quot;, &quot;age&quot;: 12&#125; &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">f = json.loads(e)</span><br><span class="line">print(f, <span class="built_in">type</span>(f))		<span class="comment"># &#123;&#x27;name&#x27;: &#x27;Marry&#x27;, &#x27;age&#x27;: 12&#125; &lt;class &#x27;dict&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="17-4-前端"><a href="#17-4-前端" class="headerlink" title="17.4 前端"></a>17.4 前端</h4><ul>
<li>将json字符串转换为json对象的方法。在数据传输过程中，json是以文本，即字符串的形式传递的，而JS操作的是JSON对象，所以，JSON对象和JSON字符串之间的相互转换是关键</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">JSON字符串:</span><br><span class="line">var str1 = <span class="string">&#x27;&#123; &quot;name&quot;: &quot;cxh&quot;, &quot;sex&quot;: &quot;man&quot; &#125;&#x27;</span>; </span><br><span class="line">JSON对象:</span><br><span class="line">var str2 = &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;cxh&quot;</span>, <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;man&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">A. JSON字符串转换为JSON对象</span><br><span class="line"></span><br><span class="line">要使用上面的str1，必须使用下面的方法先转化为JSON对象：</span><br><span class="line"></span><br><span class="line">//由JSON字符串转换为JSON对象</span><br><span class="line"></span><br><span class="line">var obj = <span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> + <span class="built_in">str</span> + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">var obj = <span class="built_in">str</span>.parseJSON(); //由JSON字符串转换为JSON对象</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">var obj = JSON.parse(<span class="built_in">str</span>); //由JSON字符串转换为JSON对象</span><br><span class="line"></span><br><span class="line">然后，就可以这样读取：</span><br><span class="line"></span><br><span class="line">Alert(obj.name);</span><br><span class="line"></span><br><span class="line">Alert(obj.sex);</span><br><span class="line"></span><br><span class="line">特别注意：如果obj本来就是一个JSON对象，那么使用<span class="built_in">eval</span>（）函数转换后（哪怕是多次转换）还是JSON对象，但是使用parseJSON（）函数处理后会有问题（抛出语法异常）。</span><br><span class="line"></span><br><span class="line">B. 可以使用toJSONString()或者全局方法JSON.stringify()将JSON对象转化为JSON字符串。</span><br><span class="line">例如：</span><br><span class="line"></span><br><span class="line">var last=obj.toJSONString(); //将JSON对象转化为JSON字符</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">var last=JSON.stringify(obj); //将JSON对象转化为JSON字符</span><br><span class="line">alert(last)</span><br></pre></td></tr></table></figure>

<h3 id="18-serializer重写"><a href="#18-serializer重写" class="headerlink" title="18 serializer重写"></a>18 serializer重写</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="comment"># 用serializer重写，不能用ModelViewSet来添加，写上id会报错username不能设为key，因为User表继承的是AbstractUser，其中的username字段必须有unique=True属性设置唯一约束</span></span><br><span class="line">    username = serializers.CharField()</span><br><span class="line">    password = serializers.CharField()</span><br><span class="line">    mobile = serializers.CharField()</span><br><span class="line">    email = serializers.EmailField()</span><br><span class="line">    token = serializers.CharField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        username = data.get(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = data.get(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        mobile = data.get(<span class="string">&#x27;mobile&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        email = data.get(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        user = User(username=username, email=email, mobile=mobile)</span><br><span class="line">        user.set_password(password)</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># 补充生成记录登录状态的token</span></span><br><span class="line">        jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line">        jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line">        payload = jwt_payload_handler(user)</span><br><span class="line">        token = jwt_encode_handler(payload)</span><br><span class="line">        user.token = token</span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># instance 是当前对象obj</span></span><br><span class="line">        <span class="comment"># validated_data 是获取的变量</span></span><br><span class="line">		instance.mobile = validated_data.get(<span class="string">&#x27;mobile&#x27;</span>)</span><br><span class="line">		instance.email = validated_data.get(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">		instance.save()</span><br><span class="line">		<span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure>

<h3 id="19-要注意ModelViewSet的接口路由"><a href="#19-要注意ModelViewSet的接口路由" class="headerlink" title="19 要注意ModelViewSet的接口路由"></a>19 要注意ModelViewSet的接口路由</h3><ul>
<li>后端接口</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 查询接口</span><br><span class="line"><span class="attribute">http://192.168.56.100:1594/user/user/</span></span><br><span class="line">http://192.168.56.100:1594/user/user/?username=&#x27;cat&#x27;</span><br><span class="line">* 添加接口</span><br><span class="line"><span class="attribute">http://192.168.56.100:1594/user/user/</span></span><br><span class="line">* 删除接口(指定用户id删除)</span><br><span class="line"><span class="attribute">http://192.168.56.100:1594/user/user/id/</span></span><br><span class="line">* 修改接口(指定用户id修改)</span><br><span class="line"><span class="attribute">http://192.168.56.100:1594/user/user/id/</span></span><br></pre></td></tr></table></figure>

<ul>
<li>前端访问路径配置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> get_userlist = <span class="function"><span class="params">P</span> =&gt;</span> axios_get(<span class="string">&#x27;/user/user/&#x27;</span>, P)     </span><br><span class="line"><span class="comment">// 查询所有：获取用户列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> search_for = <span class="function"><span class="params">P</span> =&gt;</span> axios_get(<span class="string">&#x27;user/user/?username=&#x27;</span> + P.username)   </span><br><span class="line"><span class="comment">// 查找指定信息：根据用户名查找指定用户信息并展示</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add_user = <span class="function"><span class="params">P</span> =&gt;</span> axios_post(<span class="string">&#x27;/user/user/&#x27;</span>, P)     </span><br><span class="line"><span class="comment">// 添加用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> delete_user = <span class="function"><span class="params">P</span> =&gt;</span> axios_delete(<span class="string">&#x27;/user/user/&#x27;</span> + P + <span class="string">&#x27;/&#x27;</span>)           </span><br><span class="line"><span class="comment">// 删除指定信息：根据获取到的用户id删除用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> update_user = <span class="function"><span class="params">P</span> =&gt;</span> axios_put(<span class="string">&#x27;/user/user/&#x27;</span>+ P.id +<span class="string">&#x27;/&#x27;</span>, P)    </span><br><span class="line"><span class="comment">// 修改指定信息：根绝用户id和提交来的数据修改用户信息</span></span><br></pre></td></tr></table></figure>

<h3 id="20-使用-ant-design-vue"><a href="#20-使用-ant-design-vue" class="headerlink" title="20 使用 ant-design-vue"></a>20 使用 ant-design-vue</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用ant-design-vue</span></span><br><span class="line"><span class="keyword">import</span> Antd <span class="keyword">from</span> <span class="string">&#x27;ant-design-vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;ant-design-vue/dist/antd.css&#x27;</span>;</span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line">Vue.use(Antd);</span><br></pre></td></tr></table></figure>

<h3 id="21-ModelViewSet修改问题"><a href="#21-ModelViewSet修改问题" class="headerlink" title="21 ModelViewSet修改问题"></a>21 ModelViewSet修改问题</h3><ul>
<li>put请求默认是全部修改</li>
<li>patch请求可以实现局部修改（后端已经封装好了方法）</li>
</ul>
<h3 id="22-Vue嵌套路由"><a href="#22-Vue嵌套路由" class="headerlink" title="22 Vue嵌套路由"></a>22 Vue嵌套路由</h3><ul>
<li>index.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;@/components/layout/Home&#x27;</span></span><br><span class="line"><span class="comment">// 用于导包路径的配置</span></span><br><span class="line"><span class="keyword">const</span> page = <span class="function"><span class="params">name</span> =&gt;</span> <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/&#x27;</span> + name)</span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  routes: [</span><br><span class="line">    <span class="comment">// 用户管理模块</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,<span class="attr">component</span>: Home,<span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      children: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&#x27;usermanage&#x27;</span>, <span class="attr">component</span>: page(<span class="string">&#x27;user-manage/Index&#x27;</span>), <span class="attr">name</span>: <span class="string">&#x27;用户管理&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&#x27;flowconf&#x27;</span>, <span class="attr">component</span>: page(<span class="string">&#x27;workflow/WorkFlowConf&#x27;</span>), <span class="attr">name</span>: <span class="string">&#x27;模板管理&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&#x27;flowtype&#x27;</span>, <span class="attr">component</span>: page(<span class="string">&#x27;workflow/WorkFlowType&#x27;</span>), <span class="attr">name</span>: <span class="string">&#x27;模板类型管理&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&#x27;baidu&#x27;</span>, <span class="attr">component</span>: page(<span class="string">&#x27;BaiDu&#x27;</span>), <span class="attr">name</span>: <span class="string">&#x27;跳转百度&#x27;</span> &#125;,</span><br><span class="line">      </span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>Home页面中写入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;components-layout-demo-basic&quot;&gt;</span><br><span class="line">         &lt;a-layout&gt;</span><br><span class="line">              &lt;&#x2F;a-layout-header&gt;</span><br><span class="line">                  &lt;div&gt;</span><br><span class="line">                     &lt;!-- 这里的 router-view 是绑定的路由 --&gt;</span><br><span class="line">                     &lt;router-view&gt;&lt;&#x2F;router-view&gt;</span><br><span class="line">                   &lt;&#x2F;div&gt;</span><br><span class="line">              &lt;&#x2F;a-layout-header&gt;</span><br><span class="line">          &lt;&#x2F;a-layout&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">&#x2F;&#x2F; 导入组件</span><br><span class="line">import LeftMenu from &#39;@&#x2F;components&#x2F;layout&#x2F;LeftMenu&#39;</span><br><span class="line">import Header from &#39;@&#x2F;components&#x2F;layout&#x2F;Header&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">    &#x2F;&#x2F; 注册组件</span><br><span class="line">    components:&#123;</span><br><span class="line">        LeftMenu,</span><br><span class="line">        Header</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>绑定左侧菜单LeftMenu</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;a-menu</span><br><span class="line">      style&#x3D;&quot;width: 256px&quot;</span><br><span class="line">      :default-selected-keys&#x3D;&quot;[&#39;1&#39;]&quot;</span><br><span class="line">      :default-open-keys&#x3D;&quot;[&#39;sub1&#39;]&quot;</span><br><span class="line">      :mode&#x3D;&quot;mode&quot;</span><br><span class="line">      :theme&#x3D;&quot;theme&quot;</span><br><span class="line">      @click&#x3D;&quot;handleClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;!-- 必须定义click方法，handleClick是用来跳转路由的，内置毁掉参数e，包括传递上去的key路由地址 --&gt;    </span><br><span class="line">      &lt;a-menu-item key&#x3D;&quot;usermanage&quot;&gt;</span><br><span class="line">        &lt;!-- key是路由地址 --&gt;</span><br><span class="line">        用户管理模块</span><br><span class="line">      &lt;&#x2F;a-menu-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;a-menu-item key&#x3D;&quot;baidu&quot;&gt;</span><br><span class="line">        百度翻译</span><br><span class="line">      &lt;&#x2F;a-menu-item&gt;</span><br><span class="line">    &lt;&#x2F;a-menu&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">     handleClick(e) &#123;</span><br><span class="line">      this.current &#x3D; e.key;</span><br><span class="line">      this.$router.push(&#123;path:this.current&#125;);</span><br><span class="line">      &#x2F;&#x2F; click方法默认回调参数中的 key，所以 e.key就是传递来的路由</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="23-ant-design-vue-图标大小"><a href="#23-ant-design-vue-图标大小" class="headerlink" title="23 ant-design-vue 图标大小"></a>23 ant-design-vue 图标大小</h3><ul>
<li>font-size 可以调节图标大小</li>
</ul>
<h3 id="24-v-if-v-else控制input框disabled属性"><a href="#24-v-if-v-else控制input框disabled属性" class="headerlink" title="24 v-if v-else控制input框disabled属性"></a>24 v-if v-else控制input框disabled属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;a-modal</span><br><span class="line">        title&#x3D;&quot;Please write now.&quot;</span><br><span class="line">        :visible&#x3D;&quot;visible&quot;</span><br><span class="line">        @ok&#x3D;&quot;handleOk&quot;</span><br><span class="line">        @cancel&#x3D;&quot;handleCancel&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;!-- @ok控制按钮ok --&gt;</span><br><span class="line">        &lt;!-- @cancel控制按钮cancel --&gt;</span><br><span class="line">            &lt;p v-if&#x3D;&quot;userList.id&quot;&gt;UserName：</span><br><span class="line">                &lt;a-input </span><br><span class="line">                style&#x3D;&quot;width:380px;float:right&quot; </span><br><span class="line">                placeholder&#x3D;&quot;username&quot; </span><br><span class="line">                v-model&#x3D;&quot;userList.username&quot;</span><br><span class="line">                disabled&#x3D;&quot;disabled&quot;</span><br><span class="line">                &gt;&lt;&#x2F;a-input&gt;    </span><br><span class="line">                &lt;!-- disabled可以用来控制input是否能输入文字 --&gt;</span><br><span class="line">            &lt;&#x2F;p&gt;</span><br><span class="line">            &lt;p v-else&gt;UserName：</span><br><span class="line">                &lt;a-input </span><br><span class="line">                style&#x3D;&quot;width:380px;float:right&quot; </span><br><span class="line">                placeholder&#x3D;&quot;username&quot; </span><br><span class="line">                v-model&#x3D;&quot;userList.username&quot;</span><br><span class="line">                &gt;&lt;&#x2F;a-input&gt;</span><br><span class="line">            &lt;&#x2F;p&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div v-if&#x3D;&quot;userList.id&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div v-else&gt;</span><br><span class="line">            &lt;p&gt;PassWord：</span><br><span class="line">                &lt;a-input</span><br><span class="line">                    v-decorator&#x3D;&quot;[</span><br><span class="line">                        &#39;password&#39;,</span><br><span class="line">                        &#123; rules: [&#123; required: true, message: &#39;Please input your Password!&#39; &#125;] &#125;,</span><br><span class="line">                    ]&quot;</span><br><span class="line">                    type&#x3D;&quot;password&quot;</span><br><span class="line">                    placeholder&#x3D;&quot;Password&quot;</span><br><span class="line">                    style&#x3D;&quot;width:380px;float:right&quot;</span><br><span class="line">                    v-model&#x3D;&quot;userList.password&quot;</span><br><span class="line">                    :disabled &#x3D; &#39;false&#39;</span><br><span class="line">                &gt;</span><br><span class="line">                &lt;&#x2F;a-input&gt;</span><br><span class="line">            &lt;&#x2F;p&gt;</span><br><span class="line">        &lt;&#x2F;a-modal&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    props:[&#39;visible&#39;, &#39;userList&#39;],</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleOk(e) &#123;</span><br><span class="line">            this.$emit(&#39;add&#39;)</span><br><span class="line">            &#x2F;&#x2F; add方法的调用一定要在关闭弹窗上面，否则方法不执行完毕没有办法关闭弹窗        </span><br><span class="line">            this.$emit(&#39;update:visible&#39;, false)</span><br><span class="line">        &#125;,</span><br><span class="line">        handleCancel(e) &#123;</span><br><span class="line">            this.$emit(&#39;update:visible&#39;, false)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="25-a-table中的分页器-amp-按钮"><a href="#25-a-table中的分页器-amp-按钮" class="headerlink" title="25 a-table中的分页器&amp;按钮"></a>25 a-table中的分页器&amp;按钮</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;a-table </span><br><span class="line">   :columns&#x3D;&quot;要展示的列名称（可以自定义列表）&quot; </span><br><span class="line">   :data-source&#x3D;&quot;要展示的动态数据表名&quot; </span><br><span class="line">   :pagination&#x3D;&quot;pagination&quot; </span><br><span class="line">   :rowKey&#x3D;&quot;(record,index)&#x3D;&gt;&#123;return index&#125;&quot;</span><br><span class="line"> &gt;</span><br><span class="line"> &lt;!-- 带:的都是属性绑定，不可以更换名字，带 : 就是 js 环境 --&gt;</span><br><span class="line"> &lt;!-- 不写:rowKey&#x3D;&quot;(record,index)&#x3D;&gt;&#123;return index&#125;&quot;浏览器会发出警告 --&gt;</span><br><span class="line">    &lt;p slot&#x3D;&quot;tags&quot; slot-scope&#x3D;&quot;text,tags,i&quot;&gt;</span><br><span class="line">     &lt;!-- 加入操作的按钮！其中tags是某列数据，i是索引 --&gt;</span><br><span class="line">     &lt;a-button @click&#x3D;&quot;delUser(text,tags,i)&quot;&gt;删除&lt;&#x2F;a-button&gt;</span><br><span class="line">   &lt;&#x2F;p&gt;</span><br><span class="line"> &lt;&#x2F;a-table&gt;</span><br></pre></td></tr></table></figure>

<h3 id="26-a-table中获取某一行值的方法"><a href="#26-a-table中获取某一行值的方法" class="headerlink" title="26 a-table中获取某一行值的方法"></a>26 a-table中获取某一行值的方法</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a-table </span><br><span class="line">    :columns=<span class="string">&quot;columns&quot;</span> </span><br><span class="line">    :data-source=<span class="string">&quot;userListGet&quot;</span> </span><br><span class="line">    :pagination=<span class="string">&quot;pagination&quot;</span> </span><br><span class="line">    :rowKey=<span class="string">&quot;(record,index)=&gt;&#123;return index&#125;&quot;</span></span><br><span class="line">  &gt;</span><br><span class="line">  &lt;!-- 带:的都是属性绑定，不可以更换名字，带 : 就是 js 环境 --&gt;</span><br><span class="line">    &lt;!-- 不写:rowKey=&quot;(record,index)=&gt;&#123;return index&#125;&quot;浏览器会发出警告 --&gt;</span><br><span class="line">    &lt;p slot=<span class="string">&quot;tags&quot;</span> slot-scope=<span class="string">&quot;text,tags,i&quot;</span>&gt;</span><br><span class="line">      &lt;!-- 加入操作的按钮！ --&gt;</span><br><span class="line">      &lt;a-button @click=&quot;delUser(text,tags,i)&quot;&gt;删除&lt;/a-button&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/a-table&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const columns = [</span><br><span class="line">  &#123;</span><br><span class="line">    title:<span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">    dataIndex: <span class="string">&#x27;tags&#x27;</span>,</span><br><span class="line">    key : <span class="string">&#x27;tags&#x27;</span>,</span><br><span class="line">    width: <span class="number">100</span>,</span><br><span class="line">    scopedSlots : &#123; customRender: <span class="string">&#x27;tags&#x27;</span>&#125;</span><br><span class="line">    // scopedSlots: &#123; customRender: <span class="string">&#x27;tags&#x27;</span> &#125;,一定不能少不然渲染不了html标签</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; delete_user &#125; <span class="keyword">from</span> <span class="string">&#x27;@/http/apis&#x27;</span></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      columns,//这里要返回值哦 </span><br><span class="line">      pagination:&#123;</span><br><span class="line">      pageSize: <span class="number">4</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    delUser(text,tags,i)&#123;</span><br><span class="line">       &#125;     </span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="27-控制对话框"><a href="#27-控制对话框" class="headerlink" title="27 控制对话框"></a>27 控制对话框</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义变量 isDel来控制 confirm，isDel&#x3D;&#x3D;true执行的就是对话框的 ok，isDel&#x3D;&#x3D;false执行的就是对话框的 false</span><br><span class="line">const isDel &#x3D; confirm(&#39;你确定要删除&#39; + tags.id)</span><br><span class="line">if(isDel&#x3D;&#x3D;true)&#123;</span><br><span class="line">	delete_user(tags.id).then(</span><br><span class="line">		res&#x3D;&gt;&#123;</span><br><span class="line">		&#x2F;&#x2F; 删除回调地址是  http:&#x2F;&#x2F;192.168.56.100:1594&#x2F;id&#x2F;</span><br><span class="line">		this.get()</span><br><span class="line">			alert(&#39;删除成功啦~&#39;)</span><br><span class="line">		&#125;)</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	alert(&#39;有需要再叫我哈~&#39;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="28-自动跳转到某一网址"><a href="#28-自动跳转到某一网址" class="headerlink" title="28 自动跳转到某一网址"></a>28 自动跳转到某一网址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.location.href &#x3D; &#39;https:&#x2F;&#x2F;www.baidu.com&#x2F;&#39;</span><br></pre></td></tr></table></figure>

<h3 id="29-Vue报错无法查看对象问题"><a href="#29-Vue报错无法查看对象问题" class="headerlink" title="29 Vue报错无法查看对象问题"></a>29 Vue报错无法查看对象问题</h3><ul>
<li>出现问题</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invalid prop: <span class="built_in">type</span> check failed <span class="keyword">for</span> prop <span class="string">&quot;dataSource&quot;</span>. Expected Array, got Object </span><br></pre></td></tr></table></figure>

<ul>
<li>解决方案</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.userListGet = res.results</span><br></pre></td></tr></table></figure>

<h3 id="31-Vue-Django-RestFrameWork-实现分页"><a href="#31-Vue-Django-RestFrameWork-实现分页" class="headerlink" title="31 Vue+Django-RestFrameWork 实现分页"></a>31 Vue+Django-RestFrameWork 实现分页</h3><ul>
<li><p>后端代码</p>
<ul>
<li>实现局部分页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> user.serializers <span class="keyword">import</span> UserSerializer, UserModelSerializer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页（局部）：自定义分页器 局部</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageNum</span>(<span class="params">PageNumberPagination</span>):</span></span><br><span class="line">    page_size = <span class="number">4</span>                           <span class="comment"># 每页显示多少条</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span>     <span class="comment"># 查询字符串中代表每页返回数据数量的参数名, 默认值: None</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;page&#x27;</span>               <span class="comment"># 查询字符串中代表页码的参数名, 有默认值: page</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>                    <span class="comment"># 最大页码数限制</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span>(<span class="params">viewsets.ModelViewSet</span>):</span></span><br><span class="line">    queryset = User.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = UserModelSerializer</span><br><span class="line">    filter_fields = &#123;<span class="string">&quot;username&quot;</span>&#125;</span><br><span class="line">    pagination_class = PageNum  <span class="comment"># 注意不是列表（只能有一个分页模式）</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>前端代码</p>
<ul>
<li>Pagination.vue</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;a-pagination</span><br><span class="line">      show-quick-jumper</span><br><span class="line">      :default-current&#x3D;&quot;2&quot;</span><br><span class="line">      :pageSize &#x3D; &#39;4&#39;</span><br><span class="line">      :total&#x3D;&quot;count&quot;</span><br><span class="line">      show-less-items</span><br><span class="line">      @change&#x3D;&quot;onChange&quot;</span><br><span class="line">      v-model&#x3D;&quot;current&quot;</span><br><span class="line">    &#x2F;&gt;</span><br><span class="line">      &lt;!-- 一定是change方法，不然不能跳转 --&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    props:[ &#39;count&#39; ],</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            current:1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123; </span><br><span class="line">        onChange() &#123;</span><br><span class="line">            this.$emit(&#39;getPage&#39;, this.current)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Index.vue</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;components-layout-demo-basic&quot;&gt;</span><br><span class="line">        &lt;a-layout-content&gt;</span><br><span class="line">            &lt;TableList</span><br><span class="line">                  :userListGet&#x3D;&quot;userListGet&quot;</span><br><span class="line">                  :userList&#x3D;&quot;userList&quot;</span><br><span class="line">                  @getUser&#x3D;&quot;getUser&quot;</span><br><span class="line">                  @add&#x3D;&quot;add&quot;</span><br><span class="line">             &gt;</span><br><span class="line">                    </span><br><span class="line">             &lt;&#x2F;TableList&gt;</span><br><span class="line">             &lt;Pagination</span><br><span class="line">                  @getPage&#x3D;&quot;getPage&quot; </span><br><span class="line">                  :count&#x3D;&quot;count&quot;              </span><br><span class="line">              &gt;</span><br><span class="line">    		  &lt;&#x2F;Pagination&gt;</span><br><span class="line">        &lt;&#x2F;a-layout-content&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Pagination from &quot;.&#x2F;components&#x2F;Pagination&quot;</span><br><span class="line"></span><br><span class="line">import &#123; get_userlist &#125; from &#39;@&#x2F;http&#x2F;apis&#39;;</span><br><span class="line">export default &#123;</span><br><span class="line">    components:&#123;</span><br><span class="line">        BreadCrumb,</span><br><span class="line">        TableList,</span><br><span class="line">        Search,</span><br><span class="line">        EditForm,</span><br><span class="line">        Pagination</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            userListGet:[],</span><br><span class="line">            updateUserList:[],</span><br><span class="line">            &#x2F;&#x2F; 当前页码</span><br><span class="line">            current:1,</span><br><span class="line">            &#x2F;&#x2F; 总共的数据多少条</span><br><span class="line">            count:0</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        getUser()&#123;</span><br><span class="line">          &#x2F;&#x2F; 获取用户信息列表，父组件传递给子组件</span><br><span class="line">          get_userlist(this.current).then(res&#x3D;&gt;&#123;</span><br><span class="line">            this.userListGet &#x3D; res.results</span><br><span class="line">            this.count &#x3D; res.count</span><br><span class="line">            console.log(this.count)</span><br><span class="line">            console.log(this.userListGet)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; 获取页码</span><br><span class="line">        getPage(currentChild)&#123;</span><br><span class="line">          &#x2F;&#x2F; 获取到的currentChild是子组件传递过来是第几页</span><br><span class="line">          this.current &#x3D; currentChild</span><br><span class="line">          console.log(this.current)</span><br><span class="line">          this.getUser()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">#components-layout-demo-basic &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic .ant-layout-header,</span><br><span class="line">#components-layout-demo-basic .ant-layout-footer &#123;</span><br><span class="line">  background: white;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic .ant-layout-footer &#123;</span><br><span class="line">  line-height: 1.5;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic .ant-layout-content &#123;</span><br><span class="line">  background: white;</span><br><span class="line">  color: #fff;</span><br><span class="line">  min-height: 120px;</span><br><span class="line">  line-height: 120px;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic &gt; .ant-layout &#123;</span><br><span class="line">  margin-bottom: 48px;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic &gt; .ant-layout:last-child &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="32-前后端联调分页"><a href="#32-前后端联调分页" class="headerlink" title="32 前后端联调分页"></a>32 前后端联调分页</h3><ul>
<li><p>为了解决前端+后端能同时进行分页的问题，只定义前端分页，后端如果分页就会影响前端数据，如果后端不定义分页器，就会造成后端admin难以管理。</p>
</li>
<li><p>后端代码</p>
<ul>
<li>实现局部分页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> user.serializers <span class="keyword">import</span> UserSerializer, UserModelSerializer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页（局部）：自定义分页器 局部</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageNum</span>(<span class="params">PageNumberPagination</span>):</span></span><br><span class="line">    page_size = <span class="number">4</span>                           <span class="comment"># 每页显示多少条</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span>     <span class="comment"># 查询字符串中代表每页返回数据数量的参数名, 默认值: None</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;page&#x27;</span>               <span class="comment"># 查询字符串中代表页码的参数名, 有默认值: page</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>                    <span class="comment"># 最大页码数限制</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span>(<span class="params">viewsets.ModelViewSet</span>):</span></span><br><span class="line">    queryset = User.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = UserModelSerializer</span><br><span class="line">    filter_fields = &#123;<span class="string">&quot;username&quot;</span>&#125;</span><br><span class="line">    pagination_class = PageNum  <span class="comment"># 注意不是列表（只能有一个分页模式）</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>前端代码</p>
<ul>
<li>Pagination.vue</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;a-pagination</span><br><span class="line">      show-quick-jumper</span><br><span class="line">      :default-current&#x3D;&quot;2&quot;</span><br><span class="line">      :pageSize &#x3D; &#39;4&#39;</span><br><span class="line">      :total&#x3D;&quot;count&quot;</span><br><span class="line">      show-less-items</span><br><span class="line">      @change&#x3D;&quot;onChange&quot;</span><br><span class="line">      v-model&#x3D;&quot;current&quot;</span><br><span class="line">    &#x2F;&gt;</span><br><span class="line">      &lt;!-- 一定是change方法，不然不能跳转 --&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    props:[ &#39;count&#39; ],</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            current:1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123; </span><br><span class="line">        onChange() &#123;</span><br><span class="line">            this.$emit(&#39;getPage&#39;, this.current)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Index.vue</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;components-layout-demo-basic&quot;&gt;</span><br><span class="line">        &lt;a-layout-content&gt;</span><br><span class="line">            &lt;TableList</span><br><span class="line">                  :userListGet&#x3D;&quot;userListGet&quot;</span><br><span class="line">                  :userList&#x3D;&quot;userList&quot;</span><br><span class="line">                  @getUser&#x3D;&quot;getUser&quot;</span><br><span class="line">                  @add&#x3D;&quot;add&quot;</span><br><span class="line">             &gt;</span><br><span class="line">                    </span><br><span class="line">             &lt;&#x2F;TableList&gt;</span><br><span class="line">             &lt;Pagination</span><br><span class="line">                  @getPage&#x3D;&quot;getPage&quot; </span><br><span class="line">                  :count&#x3D;&quot;count&quot;              </span><br><span class="line">              &gt;</span><br><span class="line">    		  &lt;&#x2F;Pagination&gt;</span><br><span class="line">        &lt;&#x2F;a-layout-content&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Pagination from &quot;.&#x2F;components&#x2F;Pagination&quot;</span><br><span class="line"></span><br><span class="line">import &#123; get_userlist &#125; from &#39;@&#x2F;http&#x2F;apis&#39;;</span><br><span class="line">export default &#123;</span><br><span class="line">    components:&#123;</span><br><span class="line">        BreadCrumb,</span><br><span class="line">        TableList,</span><br><span class="line">        Search,</span><br><span class="line">        EditForm,</span><br><span class="line">        Pagination</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            userListGet:[],</span><br><span class="line">            updateUserList:[],</span><br><span class="line">            &#x2F;&#x2F; 当前页码</span><br><span class="line">            current:1,</span><br><span class="line">            &#x2F;&#x2F; 总共的数据多少条</span><br><span class="line">            count:0</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        getUser()&#123;</span><br><span class="line">          &#x2F;&#x2F; 获取用户信息列表，父组件传递给子组件</span><br><span class="line">          get_userlist(this.current).then(res&#x3D;&gt;&#123;</span><br><span class="line">            this.userListGet &#x3D; res.results</span><br><span class="line">            this.count &#x3D; res.count</span><br><span class="line">            console.log(this.count)</span><br><span class="line">            console.log(this.userListGet)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; 获取页码</span><br><span class="line">        getPage(currentChild)&#123;</span><br><span class="line">          &#x2F;&#x2F; 获取到的currentChild是子组件传递过来是第几页</span><br><span class="line">          this.current &#x3D; currentChild</span><br><span class="line">          console.log(this.current)</span><br><span class="line">          this.getUser()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">#components-layout-demo-basic &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic .ant-layout-header,</span><br><span class="line">#components-layout-demo-basic .ant-layout-footer &#123;</span><br><span class="line">  background: white;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic .ant-layout-footer &#123;</span><br><span class="line">  line-height: 1.5;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic .ant-layout-content &#123;</span><br><span class="line">  background: white;</span><br><span class="line">  color: #fff;</span><br><span class="line">  min-height: 120px;</span><br><span class="line">  line-height: 120px;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic &gt; .ant-layout &#123;</span><br><span class="line">  margin-bottom: 48px;</span><br><span class="line">&#125;</span><br><span class="line">#components-layout-demo-basic &gt; .ant-layout:last-child &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="33-利用数据解耦性完善查询接口"><a href="#33-利用数据解耦性完善查询接口" class="headerlink" title="33 利用数据解耦性完善查询接口"></a>33 利用数据解耦性完善查询接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">    components:&#123;</span><br><span class="line">        BreadCrumb,</span><br><span class="line">        TableList,</span><br><span class="line">        Search,</span><br><span class="line">        EditForm,</span><br><span class="line">        Pagination</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            roleListGet:[],</span><br><span class="line">            searchList:&#123;</span><br><span class="line">                &#39;zh_name&#39;:&#39;&#39;,</span><br><span class="line">                &#39;page&#39;:1,</span><br><span class="line">                &#39;page_size&#39;:4,</span><br><span class="line">                </span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">    find()&#123;</span><br><span class="line">              &#x2F;&#x2F; 根据用户名查找用户信息</span><br><span class="line">              search_for_role(this.searchList).then(res&#x3D;&gt;&#123;</span><br><span class="line">                  this.getRole()</span><br><span class="line">                  &#x2F;&#x2F; 数据解耦性！！！查询和查询某个其实可以调用同一个接口！</span><br><span class="line">                  &#x2F;&#x2F; 查询所有：http:&#x2F;&#x2F;192.168.56.100:1594&#x2F;?page&#x3D;1&amp;zh_name&#x3D;</span><br><span class="line">                  &#x2F;&#x2F; 查询某个：http:&#x2F;&#x2F;192.168.56.100:1594&#x2F;?page&#x3D;1&amp;zh_name&#x3D;many</span><br><span class="line"></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">    getRole()&#123;</span><br><span class="line">        this.searchList.page &#x3D; this.current</span><br><span class="line">        &#x2F;&#x2F; 获取用户信息列表，父组件传递给子组件</span><br><span class="line">        get_rolelist(this.searchList).then(res&#x3D;&gt;&#123;</span><br><span class="line">        this.roleListGet &#x3D; res.results</span><br><span class="line">        this.count &#x3D; res.count</span><br><span class="line">        console.log(this.count)</span><br><span class="line">        console.log(this.roleListGet)</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="34-序列化展示外键"><a href="#34-序列化展示外键" class="headerlink" title="34 序列化展示外键"></a>34 序列化展示外键</h3><ul>
<li>方法1  新增字段储存名称，新增字段为只读，不影响同一序列化器的添加功能</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlowConfSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    flowtype_name = serializers.ReadOnlyField(source=<span class="string">&#x27;flowtype.name&#x27;</span>)</span><br><span class="line">    <span class="comment"># 第一种序列化展示方法，新增字段flowtype_name储存名称</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = FlowConf</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;count&quot;: 3,</span></span><br><span class="line"><span class="string">    &quot;next&quot;: null,</span></span><br><span class="line"><span class="string">    &quot;previous&quot;: null,</span></span><br><span class="line"><span class="string">    &quot;results&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;id&quot;: 1,</span></span><br><span class="line"><span class="string">            &quot;flowtype_name&quot;: &quot;财务工单&quot;,</span></span><br><span class="line"><span class="string">            &quot;name&quot;: &quot;请假模板1&quot;,</span></span><br><span class="line"><span class="string">            &quot;description&quot;: &quot;用于普通请假事宜&quot;,</span></span><br><span class="line"><span class="string">            &quot;customfield&quot;: &quot;[&#123;&#x27;field_name&#x27;:&#x27;请假时间&#x27;,&#x27;type:&#x27;1&#x27;&#125;,&#123;&#x27;field_name&#x27;:&#x27;截止时间&#x27;,&#x27;type&#x27;:&#x27;1&#x27;&#125;,&#123;&#x27;field_name&#x27;:&#x27;请假原由&#x27;,&#x27;type&#x27;:&#x27;2&#x27;&#125;]&quot;,</span></span><br><span class="line"><span class="string">            &quot;flowtype&quot;: 2</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>方法2  替换字段为名称，影响同一序列化器的添加功能</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlowConfSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    flowtype = serializers.SerializerMethodField()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = FlowConf</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_flowtype</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        <span class="keyword">return</span> row.flowtype.name</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;count&quot;: 3,</span></span><br><span class="line"><span class="string">    &quot;next&quot;: null,</span></span><br><span class="line"><span class="string">    &quot;previous&quot;: null,</span></span><br><span class="line"><span class="string">    &quot;results&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;id&quot;: 1,</span></span><br><span class="line"><span class="string">            &quot;flowtype&quot;: &quot;财务工单&quot;,</span></span><br><span class="line"><span class="string">            &quot;name&quot;: &quot;请假模板1&quot;,</span></span><br><span class="line"><span class="string">            &quot;description&quot;: &quot;用于普通请假事宜&quot;,</span></span><br><span class="line"><span class="string">            &quot;customfield&quot;: &quot;[&#123;&#x27;field_name&#x27;:&#x27;请假时间&#x27;,&#x27;type:&#x27;1&#x27;&#125;,&#123;&#x27;field_name&#x27;:&#x27;截止时间&#x27;,&#x27;type&#x27;:&#x27;1&#x27;&#125;,&#123;&#x27;field_name&#x27;:&#x27;请假原由&#x27;,&#x27;type&#x27;:&#x27;2&#x27;&#125;]&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="35-关于-action-属性"><a href="#35-关于-action-属性" class="headerlink" title="35 关于 action 属性"></a>35 关于 action 属性</h3><h4 id="35-1-详解"><a href="#35-1-详解" class="headerlink" title="35.1 详解"></a>35.1 详解</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">视图集ViewSet</span></span><br><span class="line"><span class="string">	继承自APIView与ViewSetMixin</span></span><br><span class="line"><span class="string">    作用也与APIView基本类似，提供了身份认证、权限校验、流量管理等</span></span><br><span class="line"><span class="string">	ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典(如&#123;‘get’:’list’&#125;)的映射处理工作</span></span><br><span class="line"><span class="string">	在ViewSet中，没有提供任何动作action方法，需要我们自己实现action方法</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">action的使用</span></span><br><span class="line"><span class="string">	在视图集中，除了上述默认的方法动作外，还可以添加自定义动作</span></span><br><span class="line"><span class="string">	只要继承了ViewSetMixin类,路由的配置就发生变化了,只需要写映射即可,视图类的方法中就会有个action</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">action的属性</span></span><br><span class="line"><span class="string">在视图集中，我们可以通过action对象属性来获取当前请求视图集时的action动作是哪个</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>实例分析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span>(<span class="params">viewsets.ModelViewSet</span>):</span></span><br><span class="line">    queryset = User.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = UserModelSerializer</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;action-------&gt;&#x27;</span>, self.action)</span><br><span class="line">        <span class="keyword">return</span> UserModelSerializer</span><br></pre></td></tr></table></figure>

<h4 id="35-2-获取某条数据"><a href="#35-2-获取某条数据" class="headerlink" title="35.2 获取某条数据"></a>35.2 获取某条数据</h4><h5 id="35-2-1-获取某条数据"><a href="#35-2-1-获取某条数据" class="headerlink" title="35.2.1 获取某条数据"></a>35.2.1 获取某条数据</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.56.100:1594/user/user/1/</span></span><br></pre></td></tr></table></figure>

<ul>
<li>返回数据<ul>
<li>获取某一条数据就不是list类型</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action-------&gt; retrieve</span><br></pre></td></tr></table></figure>

<h5 id="35-2-2-获取具体数据（查找）"><a href="#35-2-2-获取具体数据（查找）" class="headerlink" title="35.2.2 获取具体数据（查找）"></a>35.2.2 获取具体数据（查找）</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.100:1594/user/user/?username=魏魏最阔爱</span><br></pre></td></tr></table></figure>

<ul>
<li>返回数据<ul>
<li>获取到的哪怕一条数据，action动作都是list类型</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action-------&gt; list</span><br></pre></td></tr></table></figure>

<h5 id="35-2-3-添加数据"><a href="#35-2-3-添加数据" class="headerlink" title="35.2.3 添加数据"></a>35.2.3 添加数据</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.56.100:1594/user/user/</span></span><br></pre></td></tr></table></figure>

<ul>
<li>返回数据<ul>
<li>添加时create</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action-------&gt; create</span><br></pre></td></tr></table></figure>

<h3 id="36-query和params"><a href="#36-query和params" class="headerlink" title="36 query和params"></a>36 query和params</h3><ul>
<li>query和params传参的区别</li>
</ul>
<p>query传参显示参数，params传参不显示参数，params相对于query来说较安全一点</p>
<p>取值方法也有不同：query取值：this.$route.query.XXX || this.$route.params.xxx</p>
<p>query传值页面刷新数据还在，而params传值页面数据消失。</p>
<h4 id="36-1-query"><a href="#36-1-query" class="headerlink" title="36.1 query"></a>36.1 query</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 传参组件写法 --&gt;</span><br><span class="line">&lt;router-link :to&#x3D;&quot;&#123;path:&#39;&#x2F;home&#39;, query:&#123;&#39;pid&#39;:item.id&#125;&#125;&quot;&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 写在方法里 --&gt;</span><br><span class="line">jump(flowConf)&#123;</span><br><span class="line">	this.$router.push(</span><br><span class="line">		&#123;</span><br><span class="line">			path:&#39;flowconfform&#39;,</span><br><span class="line">			&#x2F;&#x2F; 如果是path:&#39;flowconfform&#x2F;&#39;,多了&#x2F;就会无法返回</span><br><span class="line">			&#39;query&#39;:&#123;</span><br><span class="line">			&#39;name&#39;:flowConf.name,</span><br><span class="line">			&#39;id&#39;:flowConf.id</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="36-2-params"><a href="#36-2-params" class="headerlink" title="36.2 params"></a>36.2 params</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="37-循环之双向绑定-添加自定义字段"><a href="#37-循环之双向绑定-添加自定义字段" class="headerlink" title="37 循环之双向绑定+添加自定义字段"></a>37 循环之双向绑定+添加自定义字段</h3><ul>
<li>父组件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">             &lt;a-row&gt;</span><br><span class="line">            &lt;a-col :span&#x3D;&quot;19&quot; style&#x3D;&quot;height:500px&quot;&gt;</span><br><span class="line">                &lt;CreateForm</span><br><span class="line">                   :msg&#x3D;&quot;flowConf&quot; </span><br><span class="line">                &gt;&lt;&#x2F;CreateForm&gt;</span><br><span class="line">            &lt;&#x2F;a-col&gt;</span><br><span class="line">            &lt;a-col :span&#x3D;&quot;5&quot; style&#x3D;&quot;height:500px;background:yellow&quot;&gt;</span><br><span class="line">                col-12</span><br><span class="line">            &lt;&#x2F;a-col&gt;</span><br><span class="line">            &lt;&#x2F;a-row&gt;</span><br><span class="line">            &lt;a-row&gt;</span><br><span class="line">            &lt;a-col :span&#x3D;&quot;24&quot; style&#x3D;&quot;height:160px&quot;&gt;</span><br><span class="line">                &lt;Check</span><br><span class="line">                    :flowConf&#x3D;&quot;flowConf&quot;</span><br><span class="line">                &gt;&lt;&#x2F;Check&gt;</span><br><span class="line">            &lt;&#x2F;a-col&gt;</span><br><span class="line">            &lt;&#x2F;a-row&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Check from &#39;@&#x2F;views&#x2F;flowconfform-manage&#x2F;components&#x2F;Check&#39;</span><br><span class="line">import CreateForm from &#39;@&#x2F;views&#x2F;flowconfform-manage&#x2F;components&#x2F;CreateForm&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">    components:&#123;</span><br><span class="line">        Check,</span><br><span class="line">        CreateForm</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            flowConf:this.$route.query.flowconf,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        changeJson()&#123;</span><br><span class="line">            const textJson &#x3D; this.flowConf.customfield</span><br><span class="line">            console.log(&#39;自定义字段&#39;, textJson)</span><br><span class="line">            const textJsonChange &#x3D; JSON.parse(textJson)</span><br><span class="line">            console.log(&#39;转换后自定义字段&#39;, textJsonChange)</span><br><span class="line">            this.flowConf.customfield &#x3D; textJsonChange</span><br><span class="line">            console.log(this.flowConf)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">    this.changeJson()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>子组件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;&lt;h1&gt;&#123;&#123; msg.customfield &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">         &lt;a-form-model :label-col&#x3D;&quot;labelCol&quot; :wrapper-col&#x3D;&quot;wrapperCol&quot;&gt;</span><br><span class="line">            &lt;a-form-model-item v-for&#x3D;&quot;(select,item) in msg.customfield.field_list&quot; :key&#x3D;&quot;item&quot;&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;p v-if&#x3D;&quot;select.field_type&#x3D;&#x3D;&#x3D;&#39;input&#39;&quot; style&#x3D;&quot;text-align:left&quot;&gt;&#123;&#123;select.verbos_name&#125;&#125;:&amp;emsp;</span><br><span class="line">                &lt;a-input v-model&#x3D;&quot;select.value&quot; style&#x3D;&quot;width:200px&quot; @change&#x3D;&quot;giveValue&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;p&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;p v-show&#x3D;&quot;select.field_type&#x3D;&#x3D;&#x3D;&#39;select&#39;&quot; style&#x3D;&quot;text-align:left&quot;&gt;</span><br><span class="line">                &#123;&#123;select.verbos_name&#125;&#125;:&amp;emsp;</span><br><span class="line">                &lt;a-select v-model&#x3D;&quot;select.value&quot; placeholder&#x3D;&quot;please select your option&quot; style&#x3D;&quot;width:200px&quot; @change&#x3D;&quot;giveValue&quot;&gt;</span><br><span class="line">                    &lt;a-select-option v-for&#x3D;&quot;s in select.field_datasource&quot; :key&#x3D;&quot;s.value&quot; :value&#x3D;&quot;s.value&quot;&gt;</span><br><span class="line">                    &#123;&#123; s.label &#125;&#125;</span><br><span class="line">                    &lt;&#x2F;a-select-option&gt;</span><br><span class="line">                &lt;&#x2F;a-select&gt;</span><br><span class="line">            &lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">            &lt;p v-show&#x3D;&quot;select.field_type&#x3D;&#x3D;&#39;textarea&#39;&quot; style&#x3D;&quot;text-align:left&quot;&gt;</span><br><span class="line">                &#123;&#123;select.verbos_name&#125;&#125;:</span><br><span class="line">                &lt;a-input v-model&#x3D;&quot;select.value&quot; type&#x3D;&quot;textarea&quot; style&#x3D;&quot;width:700px;height:150px&quot; @change&#x3D;&quot;giveValue&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;p&gt;</span><br><span class="line">            &lt;&#x2F;a-form-model-item&gt;</span><br><span class="line">            &lt;a-form-model-item :wrapper-col&#x3D;&quot;&#123; span: 14, offset: 4 &#125;&quot;&gt;</span><br><span class="line">                &lt;a-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;onSubmit&quot;&gt;</span><br><span class="line">                提交</span><br><span class="line">                &lt;&#x2F;a-button&gt;</span><br><span class="line">                &lt;a-button style&#x3D;&quot;margin-left: 10px;&quot;&gt;</span><br><span class="line">                取消</span><br><span class="line">                &lt;&#x2F;a-button&gt;</span><br><span class="line">            &lt;&#x2F;a-form-model-item&gt;</span><br><span class="line">        &lt;&#x2F;a-form-model&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props:[ &#39;msg&#39; ],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;  </span><br><span class="line">      labelCol: &#123; span: 4 &#125;,</span><br><span class="line">      wrapperCol: &#123; span: 14 &#125;,</span><br><span class="line">      form: &#123;</span><br><span class="line">        name: &#39;&#39;,</span><br><span class="line">        region: undefined,</span><br><span class="line">        date1: undefined,</span><br><span class="line">        delivery: false,</span><br><span class="line">        type: [],</span><br><span class="line">        resource: &#39;&#39;,</span><br><span class="line">        desc: &#39;&#39;,        </span><br><span class="line">      &#125;,</span><br><span class="line">      field_datasource:&#123;&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSubmit() &#123;</span><br><span class="line">      console.log(&#39;submit!&#39;, this.form);</span><br><span class="line">    &#125;,  </span><br><span class="line">    &#x2F;&#x2F; 老师的方法</span><br><span class="line">    &#x2F;&#x2F; giveValue()&#123;</span><br><span class="line">    &#x2F;&#x2F;     for(var i in this.msg.customfield.form)&#123;</span><br><span class="line">    &#x2F;&#x2F;     const val &#x3D; this.getInputValue(i);</span><br><span class="line">    &#x2F;&#x2F;     this.msg.customfield.form[i] &#x3D; val;</span><br><span class="line">    &#x2F;&#x2F;   &#125;       </span><br><span class="line">    &#x2F;&#x2F; &#125;,</span><br><span class="line">    &#x2F;&#x2F; getInputValue(key)&#123;</span><br><span class="line">    &#x2F;&#x2F;     for(var i&#x3D;0;i&lt;this.msg.customfield.field_list.length;i&#x3D;i+1)&#123;</span><br><span class="line">    &#x2F;&#x2F;         const fileld_dic &#x3D; this.msg.customfield.field_list[i];</span><br><span class="line">    &#x2F;&#x2F;         const k1 &#x3D; fileld_dic[&#39;name&#39;];</span><br><span class="line">    &#x2F;&#x2F;         if(key &#x3D;&#x3D; k1)&#123;</span><br><span class="line">    &#x2F;&#x2F;         return fileld_dic[&#39;value&#39;]</span><br><span class="line">    &#x2F;&#x2F;     &#125;</span><br><span class="line">    &#x2F;&#x2F;   &#125;</span><br><span class="line">    &#x2F;&#x2F;   return &#39;&#39;</span><br><span class="line">    &#x2F;&#x2F; &#125;</span><br><span class="line">    giveValue()&#123;</span><br><span class="line">        const form_list &#x3D; Object.keys(this.msg.customfield.form) </span><br><span class="line">        &#x2F;&#x2F; 可以获取到所有的key</span><br><span class="line">        for(var i&#x3D;0;i&lt;this.msg.customfield.field_list.length;i++)&#123;</span><br><span class="line">            form_list.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">                if(this.msg.customfield.field_list[i].name&#x3D;&#x3D;item)&#123;</span><br><span class="line">                    this.msg.customfield.form[item]&#x3D;this.msg.customfield.field_list[i].value</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        return this.msg</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="38-serializer之元祖类型怎么展示名字"><a href="#38-serializer之元祖类型怎么展示名字" class="headerlink" title="38 serializer之元祖类型怎么展示名字"></a>38 serializer之元祖类型怎么展示名字</h3><h4 id="38-1-models字段"><a href="#38-1-models字段" class="headerlink" title="38.1 models字段"></a>38.1 models字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WorkOrderModel</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;审批中&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;被驳回&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;完成&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    order_status = models.CharField(<span class="string">&#x27;工单状态&#x27;</span>, help_text=<span class="string">&#x27;审批中/被驳回/完成&#x27;</span>, choices=status_choices, default=<span class="string">&#x27;1&#x27;</span>, max_length=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<h4 id="38-2-serializers写法"><a href="#38-2-serializers写法" class="headerlink" title="38.2 serializers写法"></a>38.2 serializers写法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WorkOrderSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    order_status_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = WorkOrderModel</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_order_status_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        status_choices = <span class="built_in">dict</span>(row.status_choices)</span><br><span class="line">        <span class="keyword">return</span> status_choices[row.order_status]</span><br></pre></td></tr></table></figure>

<h3 id="39-Vue前端json格式注意事项"><a href="#39-Vue前端json格式注意事项" class="headerlink" title="39 Vue前端json格式注意事项"></a>39 Vue前端json格式注意事项</h3><ul>
<li>前端接收到的数据只有在是json字符串格式（双引号）的情况下才能转换成json格式！</li>
<li>从数据库获取到的数据默认是单引号！</li>
</ul>
<h4 id="39-1-Vue把单引号变成双引号的方法"><a href="#39-1-Vue把单引号变成双引号的方法" class="headerlink" title="39.1 Vue把单引号变成双引号的方法"></a>39.1 Vue把单引号变成双引号的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const data &#x3D; res.results              </span><br><span class="line">var dic &#x3D; data.replace(&#x2F;&#39;&#x2F;g, &#39;&quot;&#39;)</span><br></pre></td></tr></table></figure>

<h4 id="39-2-把双引号数据变成json格式"><a href="#39-2-把双引号数据变成json格式" class="headerlink" title="39.2 把双引号数据变成json格式"></a>39.2 把双引号数据变成json格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.form &#x3D; JSON.parse(dic)</span><br></pre></td></tr></table></figure>

<h3 id="40-后端常见问题（filter-amp-get）"><a href="#40-后端常见问题（filter-amp-get）" class="headerlink" title="40 后端常见问题（filter&amp;get）"></a>40 后端常见问题（filter&amp;get）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj1 = FlowConf.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>)			<span class="comment"># 这是个列表（嵌套字典形式），是queryset对象</span></span><br><span class="line">obj2 = FlowConf.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)  				<span class="comment"># 找不到会报错，具体值</span></span><br><span class="line">obj3 = FlowConf.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>)[<span class="number">0</span>]			<span class="comment"># obj对象（字典形式，.name可以取出具体值）</span></span><br></pre></td></tr></table></figure>

<h3 id="41-前端常见问题（登录不上）"><a href="#41-前端常见问题（登录不上）" class="headerlink" title="41 前端常见问题（登录不上）"></a>41 前端常见问题（登录不上）</h3><ul>
<li>前端登录不上<ul>
<li>login页面有问题：登录成功没有设置token（页面就能查看）</li>
<li>main.js有问题：查看全局过滤配置，可能没有设置token</li>
<li>http/index.js有问题：后端身份验证失败：错误token/token过期</li>
</ul>
</li>
</ul>
<h3 id="42-VUE端v-for循环解决textarea框重复输入的问题"><a href="#42-VUE端v-for循环解决textarea框重复输入的问题" class="headerlink" title="42 VUE端v-for循环解决textarea框重复输入的问题"></a>42 VUE端v-for循环解决textarea框重复输入的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">         &lt;div v-for&#x3D;&quot; (self, item) in list&quot; :key&#x3D;&quot;item&quot;&gt;                         </span><br><span class="line">           &lt;a-textarea</span><br><span class="line">               v-model&#x3D;&quot;value[item]&quot;</span><br><span class="line">           &#x2F;&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            value:[],</span><br><span class="line">            list:[</span><br><span class="line">                &#123;&#39;id&#39;:1&#125;,</span><br><span class="line">                &#123;&#39;id&#39;:2&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="43-自己写的一个权限验证"><a href="#43-自己写的一个权限验证" class="headerlink" title="43 自己写的一个权限验证"></a>43 自己写的一个权限验证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubOrderView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        token = request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>)</span><br><span class="line">        <span class="comment"># 用户id和角色</span></span><br><span class="line">        user_info = jwt_decode_handler(token[<span class="number">4</span>:])</span><br><span class="line">        user_id = user_info.get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">        role_info = UserRole.objects.<span class="built_in">filter</span>(user_id=user_id).values(<span class="string">&#x27;role_id&#x27;</span>)</span><br><span class="line">        role_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> role_info:</span><br><span class="line">            role_list.append(i.get(<span class="string">&#x27;role_id&#x27;</span>))</span><br><span class="line">        <span class="comment"># 实例化子工单id</span></span><br><span class="line">        suborder_id = request.query_params.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">        <span class="comment"># 审批类型id，1角色审批，2指定人审批</span></span><br><span class="line">        approve_type_id = SubOrderModel.objects.<span class="built_in">filter</span>(pk=suborder_id).first().approve_type_id</span><br><span class="line">        <span class="keyword">if</span> approve_type_id == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            approve_userrole_id = SubOrderModel.objects.<span class="built_in">filter</span>(pk=suborder_id).first().approve_userrole_id</span><br><span class="line">            <span class="keyword">if</span> approve_userrole_id <span class="keyword">in</span> role_list:</span><br><span class="line">                <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;有审批权限&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;无审批权限&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">0</span>&#125;)</span><br><span class="line">        <span class="keyword">elif</span> approve_type_id == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            approve_user = SubOrderModel.objects.<span class="built_in">filter</span>(pk=suborder_id).first().approve_user</span><br><span class="line">            <span class="keyword">if</span> user_id == approve_user:</span><br><span class="line">                <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;有审批权限&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;无审批权限&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">0</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="44-JWT生成token"><a href="#44-JWT生成token" class="headerlink" title="44 JWT生成token"></a>44 JWT生成token</h3><h4 id="44-1-settings-py"><a href="#44-1-settings-py" class="headerlink" title="44.1 settings.py"></a>44.1 settings.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Django settings for opwf project.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generated by &#x27;django-admin startproject&#x27; using Django 2.0.13.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information on this file, see</span></span><br><span class="line"><span class="string">https://docs.djangoproject.com/en/2.0/topics/settings/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For the full list of settings and their values, see</span></span><br><span class="line"><span class="string">https://docs.djangoproject.com/en/2.0/ref/settings/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>, os.path.join(BASE_DIR, <span class="string">&#x27;apps&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Quick-start development settings - unsuitable for production</span></span><br><span class="line"><span class="comment"># See https://docs.djangoproject.com/en/2.0/howto/deployment/checklist/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SECURITY WARNING: keep the secret key used in production secret!</span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;uorj1ni^mnut@wo@c%)iv)%5=8dxlml4-j0!f3b%4#f*8a5)3t&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SECURITY WARNING: don&#x27;t run with debug turned on in production!</span></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Application definition</span></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user.apps.UserConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;workflow.apps.WorkflowConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;workerorder.apps.WorkerorderConfig&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;jwt&#x27;,</span></span><br><span class="line">    <span class="comment"># &#x27;rest_framework_jwt&#x27;,</span></span><br><span class="line">    <span class="comment"># &#x27;rest_framework.authentication&#x27;</span></span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ROOT_URLCONF = <span class="string">&#x27;opwf.urls&#x27;</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">WSGI_APPLICATION = <span class="string">&#x27;opwf.wsgi.application&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Database</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/ref/settings/#databases</span></span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;opwf_db&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Password validation</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/ref/settings/#auth-password-validators</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 文档报错： AttributeError: ‘AutoSchema’ object has no attribute ‘get_link’</span></span><br><span class="line">    <span class="comment"># 用下面的设置可以解决</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.schemas.AutoSchema&#x27;</span>,</span><br><span class="line">    <span class="comment"># 默认设置是:</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_SCHEMA_CLASS&#x27;: &#x27;rest_framework.schemas.openapi.AutoSchema&#x27;,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 异常处理器</span></span><br><span class="line">    <span class="comment"># &#x27;EXCEPTION_HANDLER&#x27;: &#x27;user.utils.exception_handler&#x27;,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Base API policies    　　默认渲染器类</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 默认解析器类</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 1.认证器（全局）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;</span>,  <span class="comment"># 在 DRF中配置JWT认证</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.authentication.SessionAuthentication&#x27;,  # 使用session时的认证器</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.authentication.BasicAuthentication&#x27;  # 提交表单时的认证器</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.权限配置（全局）： 顺序靠上的严格</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAdminUser&#x27;,  # 管理员可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticated&#x27;,  # 认证用户可以访问</span></span><br><span class="line">        <span class="comment"># &#x27;rest_framework.permissions.IsAuthenticatedOrReadOnly&#x27;,  # 认证用户可以访问, 否则只能读取</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.permissions.AllowAny&#x27;</span>,  <span class="comment"># 所有用户都可以访问</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 3.限流（防爬虫）</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># 3.1限流策略</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;</span></span><br><span class="line">    <span class="comment">#     &#x27;user&#x27;: &#x27;100/hour&#x27;,  # 认证用户每小时100次</span></span><br><span class="line">    <span class="comment">#     &#x27;anon&#x27;: &#x27;300/day&#x27;,  # 未认证用户每天能访问3次</span></span><br><span class="line">    <span class="comment"># &#125;,</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;DEFAULT_CONTENT_NEGOTIATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.negotiation.DefaultContentNegotiation&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_METADATA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.metadata.SimpleMetadata&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSIONING_CLASS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.分页（全局）：全局分页器, 例如 省市区的数据自定义分页器, 不需要分页</span></span><br><span class="line">    <span class="comment"># &#x27;DEFAULT_PAGINATION_CLASS&#x27;: &#x27;rest_framework.pagination.PageNumberPagination&#x27;,</span></span><br><span class="line">    <span class="comment"># # 每页返回数量</span></span><br><span class="line">    <span class="comment"># &#x27;PAGE_SIZE&#x27;: 3,</span></span><br><span class="line">    <span class="comment"># 5.过滤器后端</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;django_filters.rest_framework.backends.DjangoFilterBackend&#x27;, 包路径有变化</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.1过滤排序（全局）：Filtering 过滤排序</span></span><br><span class="line">    <span class="string">&#x27;SEARCH_PARAM&#x27;</span>: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ORDERING_PARAM&#x27;</span>: <span class="string">&#x27;ordering&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NUM_PROXIES&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.版本控制：Versioning  接口版本控制</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_VERSION&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;ALLOWED_VERSIONS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;VERSION_PARAM&#x27;</span>: <span class="string">&#x27;version&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Authentication  认证</span></span><br><span class="line">    <span class="comment"># 未认证用户使用的用户类型</span></span><br><span class="line">    <span class="string">&#x27;UNAUTHENTICATED_USER&#x27;</span>: <span class="string">&#x27;django.contrib.auth.models.AnonymousUser&#x27;</span>,</span><br><span class="line">    <span class="comment"># 未认证用户使用的Token值</span></span><br><span class="line">    <span class="string">&#x27;UNAUTHENTICATED_TOKEN&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># View configuration</span></span><br><span class="line">    <span class="string">&#x27;VIEW_NAME_FUNCTION&#x27;</span>: <span class="string">&#x27;rest_framework.views.get_view_name&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;VIEW_DESCRIPTION_FUNCTION&#x27;</span>: <span class="string">&#x27;rest_framework.views.get_view_description&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;NON_FIELD_ERRORS_KEY&#x27;</span>: <span class="string">&#x27;non_field_errors&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Testing</span></span><br><span class="line">    <span class="string">&#x27;TEST_REQUEST_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.MultiPartRenderer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;TEST_REQUEST_DEFAULT_FORMAT&#x27;</span>: <span class="string">&#x27;multipart&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Hyperlink settings</span></span><br><span class="line">    <span class="string">&#x27;URL_FORMAT_OVERRIDE&#x27;</span>: <span class="string">&#x27;format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;FORMAT_SUFFIX_KWARG&#x27;</span>: <span class="string">&#x27;format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;URL_FIELD_NAME&#x27;</span>: <span class="string">&#x27;url&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Encoding</span></span><br><span class="line">    <span class="string">&#x27;UNICODE_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;COMPACT_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;STRICT_JSON&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;COERCE_DECIMAL_TO_STRING&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;UPLOADED_FILES_USE_URL&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Browseable API</span></span><br><span class="line">    <span class="string">&#x27;HTML_SELECT_CUTOFF&#x27;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="string">&#x27;HTML_SELECT_CUTOFF_TEXT&#x27;</span>: <span class="string">&quot;More than &#123;count&#125; items...&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Schemas</span></span><br><span class="line">    <span class="string">&#x27;SCHEMA_COERCE_PATH_PK&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;SCHEMA_COERCE_METHOD_NAMES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;retrieve&#x27;</span>: <span class="string">&#x27;read&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;destroy&#x27;</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x27;Access-Control-Allow-Origin&#x27;:&#x27;http://localhost:8080&#x27;,</span></span><br><span class="line">    <span class="comment"># &#x27;Access-Control-Allow-Credentials&#x27;: True</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AUTH_PASSWORD_VALIDATORS = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.MinimumLengthValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.CommonPasswordValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django.contrib.auth.password_validation.NumericPasswordValidator&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Internationalization</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/topics/i18n/</span></span><br><span class="line"></span><br><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">USE_L10N = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Static files (CSS, JavaScript, Images)</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.0/howto/static-files/</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;user.User&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jwt载荷中的有效期设置</span></span><br><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    <span class="comment"># 1.token前缀：headers中 Authorization 值的前缀</span></span><br><span class="line">    <span class="string">&#x27;JWT_AUTH_HEADER_PREFIX&#x27;</span>: <span class="string">&#x27;JWT&#x27;</span>,</span><br><span class="line">    <span class="comment"># 2.token有效期：一天有效</span></span><br><span class="line">    <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">1</span>),</span><br><span class="line">    <span class="comment"># 3.刷新token：允许使用旧的token换新token</span></span><br><span class="line">    <span class="string">&#x27;JWT_ALLOW_REFRESH&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># 4.token有效期：token在24小时内过期, 可续期token</span></span><br><span class="line">    <span class="string">&#x27;JWT_REFRESH_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(hours=<span class="number">24</span>),</span><br><span class="line">    <span class="comment"># 5.自定义JWT载荷信息：自定义返回格式，需要手工创建</span></span><br><span class="line">    <span class="string">&#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;</span>: <span class="string">&#x27;user.utils.jwt_response_payload_handler&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="44-2-utils-py"><a href="#44-2-utils-py" class="headerlink" title="44.2 utils.py"></a>44.2 utils.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jwt_response_payload_handler</span>(<span class="params">token, user=<span class="literal">None</span>, request=<span class="literal">None</span>, role=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        自定义jwt认证成功返回数据</span></span><br><span class="line"><span class="string">        :token 返回的jwt</span></span><br><span class="line"><span class="string">        :user 当前登录的用户信息[对象]</span></span><br><span class="line"><span class="string">        :request 当前本次客户端提交过来的数据</span></span><br><span class="line"><span class="string">        :role 角色</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> user.first_name:</span><br><span class="line">        name = user.first_name</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = user.username</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;authenticated&#x27;</span>: <span class="string">&#x27;true&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;id&#x27;</span>: user.<span class="built_in">id</span>,</span><br><span class="line">             <span class="string">&quot;role&quot;</span>: role,</span><br><span class="line">             <span class="string">&#x27;name&#x27;</span>: name,</span><br><span class="line">             <span class="string">&#x27;username&#x27;</span>: user.username,</span><br><span class="line">             <span class="string">&#x27;email&#x27;</span>: user.email,</span><br><span class="line">             <span class="string">&#x27;token&#x27;</span>: token,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h4 id="44-3-models-py"><a href="#44-3-models-py" class="headerlink" title="44.3 models.py"></a>44.3 models.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">AbstractUser</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    username：用户名</span></span><br><span class="line"><span class="string">    password：密码</span></span><br><span class="line"><span class="string">    mobile：手机号</span></span><br><span class="line"><span class="string">    email：邮箱</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">30</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 写上 unique=True 就可以指定唯一，验证字段的时候自动验证</span></span><br><span class="line">    password = models.CharField(max_length=<span class="number">256</span>)</span><br><span class="line">    mobile = models.CharField(max_length=<span class="number">11</span>)</span><br><span class="line">    email = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    token = models.CharField(max_length=<span class="number">256</span>, default=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    weixin = models.CharField(max_length=<span class="number">30</span>, null=<span class="literal">True</span>)</span><br><span class="line">    date_joined = models.DateField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;user_user&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;用户表&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<h4 id="44-4-serializers-py"><a href="#44-4-serializers-py" class="headerlink" title="44.4 serializers.py"></a>44.4 serializers.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.serializers <span class="keyword">import</span> jwt_payload_handler</span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.settings <span class="keyword">import</span> api_settings</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = serializers.IntegerField(read_only=<span class="literal">True</span>)</span><br><span class="line">    username = serializers.CharField()</span><br><span class="line">    password = serializers.CharField()</span><br><span class="line">    mobile = serializers.CharField()</span><br><span class="line">    email = serializers.EmailField()</span><br><span class="line">    weixin = serializers.CharField()</span><br><span class="line">    token = serializers.CharField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        username = data.get(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = data.get(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        mobile = data.get(<span class="string">&#x27;mobile&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        email = data.get(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        weixin = data.get(<span class="string">&#x27;weixin&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        user = User(username=username, email=email, mobile=mobile, weixin=weixin)</span><br><span class="line">        user.set_password(password)</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># 补充生成记录登录状态的token</span></span><br><span class="line">        jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line">        jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line">        payload = jwt_payload_handler(user)</span><br><span class="line">        token = jwt_encode_handler(payload)</span><br><span class="line">        user.token = token</span><br><span class="line">        <span class="keyword">return</span> user</span><br></pre></td></tr></table></figure>

<h4 id="44-5-urls-py"><a href="#44-5-urls-py" class="headerlink" title="44.5 urls.py"></a>44.5 urls.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> obtain_jwt_token</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = DefaultRouter()</span><br><span class="line">router.register(<span class="string">r&#x27;user&#x27;</span>, views.UserViewSet)</span><br><span class="line">router.register(<span class="string">r&#x27;user_get&#x27;</span>, views.UserGetViewSet)</span><br><span class="line">router.register(<span class="string">r&#x27;role&#x27;</span>, views.RoleViewSet)</span><br><span class="line">router.register(<span class="string">r&#x27;role_get&#x27;</span>, views.RoleGetViewSet)</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;login/&#x27;</span>, obtain_jwt_token),</span><br><span class="line">    path(<span class="string">&#x27;register/&#x27;</span>, views.RegisterView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="45-token解码"><a href="#45-token解码" class="headerlink" title="45 token解码"></a>45 token解码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果是APIView获取的，在VUE中定义的，可以使用以下方式解密</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.utils <span class="keyword">import</span> jwt_decode_handler</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        token = request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>)</span><br><span class="line">        <span class="comment"># 用户id和角色</span></span><br><span class="line">        user_info = jwt_decode_handler(token[<span class="number">4</span>:])</span><br></pre></td></tr></table></figure>

<h3 id="46-serializer-关于查询"><a href="#46-serializer-关于查询" class="headerlink" title="46 serializer 关于查询"></a>46 serializer 关于查询</h3><ul>
<li>以工单表和工单子表为例</li>
</ul>
<h4 id="46-1-models-py"><a href="#46-1-models-py" class="headerlink" title="46.1 models.py"></a>46.1 models.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">from</span> utils.MyBaseModel <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> workflow.models <span class="keyword">import</span> FlowConf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WorkOrderModel</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    flowconf：工单名称（一对多，FlowConf）</span></span><br><span class="line"><span class="string">    create_user：工单创建用户（一对多，User表）</span></span><br><span class="line"><span class="string">    create_ts：创建时间</span></span><br><span class="line"><span class="string">    order_status：工单状态（审批中/被驳回/完成）</span></span><br><span class="line"><span class="string">    description：描述（text，存储用户工单描述）</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;审批中&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;被驳回&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;完成&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    flowconf = models.ForeignKey(FlowConf, on_delete=models.CASCADE, null=<span class="literal">True</span>)</span><br><span class="line">    create_user = models.ForeignKey(User, on_delete=models.CASCADE)</span><br><span class="line">    order_status = models.CharField(<span class="string">&#x27;工单状态&#x27;</span>, help_text=<span class="string">&#x27;审批中/被驳回/完成&#x27;</span>, choices=status_choices, default=<span class="string">&#x27;1&#x27;</span>, max_length=<span class="number">30</span>)</span><br><span class="line">    parameter = models.TextField(default=<span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    <span class="comment"># description = models.TextField(&#x27;描述&#x27;, help_text=&#x27;存储用户工单描述&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;workerorder_workerorder&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;实例化工单&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubOrderModel</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mainorder：一对多（WorkOrder）实例化工单相连</span></span><br><span class="line"><span class="string">    approve_user：一对多（内置User表）审批人</span></span><br><span class="line"><span class="string">    approbe_user_role：审批角色</span></span><br><span class="line"><span class="string">    approve_userrole_id：审批角色id</span></span><br><span class="line"><span class="string">    sequence_number：审批序号</span></span><br><span class="line"><span class="string">    approve_ts：审批时间</span></span><br><span class="line"><span class="string">    action_status：审批状态（待审批/通过/拒绝/退回）</span></span><br><span class="line"><span class="string">    suborder_status：子任务状态（待处理/已经处理/待上一节点处理）</span></span><br><span class="line"><span class="string">    approve_text：审批意见</span></span><br><span class="line"><span class="string">    approve_type_id: 审批类型</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    action_status_choices = (</span><br><span class="line">        (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;待审批&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;通过&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;拒绝&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;退回&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    suborder_status_choices = (</span><br><span class="line">        (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;待处理&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;已经处理&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;待上一节点处理&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    mainorder = models.ForeignKey(WorkOrderModel, on_delete=models.CASCADE)</span><br><span class="line">    approve_user = models.ForeignKey(User, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, on_delete=models.SET_NULL, default=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    approbe_user_role = models.CharField(<span class="string">&#x27;审批角色&#x27;</span>, max_length=<span class="number">30</span>, null=<span class="literal">True</span>)</span><br><span class="line">    approve_userrole_id = models.IntegerField(<span class="string">&#x27;审批角色id&#x27;</span>)</span><br><span class="line">    sequence_number = models.IntegerField(<span class="string">&#x27;审批序号&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    approve_ts = models.DateTimeField(<span class="string">&#x27;审批时间&#x27;</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    action_status = models.CharField(<span class="string">&#x27;审批状态&#x27;</span>, help_text=<span class="string">&#x27;待审批/通过/拒绝/退回&#x27;</span>, choices=action_status_choices, default=<span class="string">&#x27;1&#x27;</span>, max_length=<span class="number">30</span>)</span><br><span class="line">    suborder_status = models.CharField(<span class="string">&#x27;子任务状态&#x27;</span>, help_text=<span class="string">&#x27;待处理/已经处理/待上一节点处理&#x27;</span>, choices=suborder_status_choices, default=<span class="string">&#x27;1&#x27;</span>, max_length=<span class="number">30</span>)</span><br><span class="line">    approve_text = models.TextField(<span class="string">&#x27;审批意见&#x27;</span>)</span><br><span class="line">    type_choice = (</span><br><span class="line">        (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;角色审批&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;指定人员审批&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    approve_type_id = models.CharField(max_length=<span class="number">30</span>, choices=type_choice)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;workerorder_suborder&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;实例化子工单&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<h4 id="46-2-serializer-py"><a href="#46-2-serializer-py" class="headerlink" title="46.2 serializer.py"></a>46.2 serializer.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> workerorder.models <span class="keyword">import</span> WorkOrderModel, SubOrderModel</span><br><span class="line"><span class="keyword">from</span> workflow.models <span class="keyword">import</span> FlowConf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WorkOrderSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    order_status_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line">    create_user_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line">    flowconf_name = serializers.CharField(required=<span class="literal">False</span>, source=<span class="string">&#x27;flowconf.name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = WorkOrderModel</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_order_status_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        status_choices = <span class="built_in">dict</span>(row.status_choices)</span><br><span class="line">        <span class="keyword">return</span> status_choices[row.order_status]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_create_user_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        <span class="comment"># print(type(row.create_user.username))</span></span><br><span class="line">        <span class="comment"># str</span></span><br><span class="line">        <span class="keyword">return</span> row.create_user.username</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubOrderSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    approve_user_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line">    action_status_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line">    suborder_status_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line">    flowconf_name = serializers.SerializerMethodField(required=<span class="literal">False</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = SubOrderModel</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_action_status_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(row.action_status_choices)[row.action_status]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_suborder_status_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(row.suborder_status_choices)[row.suborder_status]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_approve_user_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        <span class="keyword">if</span> row.approve_user:</span><br><span class="line">            <span class="keyword">return</span> row.approve_user.username</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_flowconf_name</span>(<span class="params">self, row</span>):</span></span><br><span class="line">        <span class="keyword">return</span> row.mainorder.flowconf.name</span><br></pre></td></tr></table></figure>

<h3 id="47-Model字段类型"><a href="#47-Model字段类型" class="headerlink" title="47 Model字段类型"></a>47 Model字段类型</h3><h4 id="47-1-常用字段类型"><a href="#47-1-常用字段类型" class="headerlink" title="47.1 常用字段类型"></a>47.1 常用字段类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGroup</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    uid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>,null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    email = models.EmailField(max_length=<span class="number">32</span>)</span><br><span class="line">    text = models.TextField()</span><br><span class="line"></span><br><span class="line">    ctime = models.DateTimeField(auto_now_add=<span class="literal">True</span>)      <span class="comment"># 只有添加时才会更新时间</span></span><br><span class="line">    uptime = models.DateTimeField(auto_now=<span class="literal">True</span>)         <span class="comment"># 只要修改就会更新时间</span></span><br><span class="line"></span><br><span class="line">    ip1 = models.IPAddressField()                  <span class="comment"># 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span></span><br><span class="line">    ip2 = models.GenericIPAddressField()           <span class="comment"># 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span></span><br><span class="line"></span><br><span class="line">    active = models.BooleanField(default=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    data01 = models.DateTimeField()                      <span class="comment"># 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ</span></span><br><span class="line">    data02 = models.DateField()                          <span class="comment"># 日期格式      YYYY-MM-DD</span></span><br><span class="line">    data03 = models.TimeField()                          <span class="comment"># 时间格式      HH:MM[:ss[.uuuuuu]]</span></span><br><span class="line"></span><br><span class="line">    age = models.PositiveIntegerField()           <span class="comment"># 正小整数 0 ～ 32767</span></span><br><span class="line">    balance = models.SmallIntegerField()          <span class="comment"># 小整数 -32768 ～ 32767</span></span><br><span class="line">    money = models.PositiveIntegerField()         <span class="comment"># 正整数 0 ～ 2147483647</span></span><br><span class="line">    bignum = models.BigIntegerField()             <span class="comment"># 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807</span></span><br><span class="line">    </span><br><span class="line">    user_type_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&quot;超级用户&quot;</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">&quot;普通用户&quot;</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">&quot;普普通用户&quot;</span>),</span><br><span class="line">    )</span><br><span class="line">    user_type_id = models.IntegerField(choices=user_type_choices, default=<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="47-2-不常用字段类型"><a href="#47-2-不常用字段类型" class="headerlink" title="47.2 不常用字段类型"></a>47.2 不常用字段类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">URLField(CharField)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"></span><br><span class="line">    SlugField(CharField)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"></span><br><span class="line">    CommaSeparatedIntegerField(CharField)</span><br><span class="line">        - 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"></span><br><span class="line">    UUIDField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"></span><br><span class="line">    FilePathField(Field)</span><br><span class="line">        - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line">        - 参数：</span><br><span class="line">                path,                      文件夹路径</span><br><span class="line">                match=<span class="literal">None</span>,                正则匹配</span><br><span class="line">                recursive=<span class="literal">False</span>,           递归下面的文件夹</span><br><span class="line">                allow_files=<span class="literal">True</span>,          允许文件</span><br><span class="line">                allow_folders=<span class="literal">False</span>,       允许文件夹</span><br><span class="line"></span><br><span class="line">    FileField(Field)</span><br><span class="line">        - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">        - 参数：</span><br><span class="line">            upload_to = <span class="string">&quot;&quot;</span>      上传文件的保存路径</span><br><span class="line">            storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"></span><br><span class="line">    ImageField(FileField)</span><br><span class="line">        - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">        - 参数：</span><br><span class="line">            upload_to = <span class="string">&quot;&quot;</span>      上传文件的保存路径</span><br><span class="line">            storage = <span class="literal">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line">            width_field=<span class="literal">None</span>,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line">            height_field=<span class="literal">None</span>   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    DurationField(Field)</span><br><span class="line">        - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line"></span><br><span class="line">    FloatField(Field)</span><br><span class="line">        - 浮点型</span><br><span class="line"></span><br><span class="line">    DecimalField(Field)</span><br><span class="line">        - <span class="number">10</span>进制小数</span><br><span class="line">        - 参数：</span><br><span class="line">            max_digits，小数总长度</span><br><span class="line">            decimal_places，小数位长度</span><br><span class="line"></span><br><span class="line">    BinaryField(Field)</span><br><span class="line">        - 二进制类型</span><br></pre></td></tr></table></figure>

<h3 id="48-一对多ForeignKey可选参数"><a href="#48-一对多ForeignKey可选参数" class="headerlink" title="48 一对多ForeignKey可选参数"></a>48 一对多ForeignKey可选参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、to,                                          <span class="comment"># 要进行关联的表名</span></span><br><span class="line"><span class="number">2</span>、to_field=<span class="literal">None</span>,                               <span class="comment"># 要关联的表中的字段名称</span></span><br><span class="line"><span class="number">3</span>、on_delete=<span class="literal">None</span>,                              <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></span><br><span class="line">            - models.CASCADE                    <span class="comment"># ，删除关联数据，与之关联也删除</span></span><br><span class="line">            - models.DO_NOTHING                 <span class="comment"># ，删除关联数据，引发错误IntegrityError</span></span><br><span class="line">            - models.PROTECT                    <span class="comment"># ，删除关联数据，引发错误ProtectedError</span></span><br><span class="line">            - models.SET_NULL                   <span class="comment"># ，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span></span><br><span class="line">            - models.SET_DEFAULT                <span class="comment"># ，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span></span><br><span class="line">            - models.SET                        <span class="comment"># ，删除关联数据，</span></span><br><span class="line"><span class="number">4</span>、related_name=<span class="literal">None</span>,                           <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span></span><br><span class="line">                                                <span class="comment"># 在做自关联时必须指定此字段，防止查找冲突</span></span><br><span class="line"><span class="number">5</span>、delated_query_name=<span class="literal">None</span>,                     <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】</span></span><br><span class="line">                                                <span class="comment"># 如：models.UserGroup.objects.filter(表名__字段名=1).values(&#x27;表名__字段名&#x27;)</span></span><br><span class="line"><span class="number">6</span>、limit_choices_to=<span class="literal">None</span>,                       <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></span><br><span class="line">            - limit_choices_to=&#123;<span class="string">&#x27;nid__gt&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">            - limit_choices_to=<span class="keyword">lambda</span> : &#123;<span class="string">&#x27;nid__gt&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line"><span class="number">7</span>、db_constraint=<span class="literal">True</span>                           <span class="comment"># 是否在数据库中创建外键约束</span></span><br><span class="line"><span class="number">8</span>、parent_link=<span class="literal">False</span>                            <span class="comment"># 在Admin中是否显示关联数据</span></span><br><span class="line">一对多ForeignKey可选参数</span><br></pre></td></tr></table></figure>

<h3 id="49-Django-一对多表结构操作"><a href="#49-Django-一对多表结构操作" class="headerlink" title="49 Django 一对多表结构操作"></a>49 Django 一对多表结构操作</h3><h4 id="49-1-一对多基本增删改查"><a href="#49-1-一对多基本增删改查" class="headerlink" title="49.1 一对多基本增删改查"></a>49.1 一对多基本增删改查</h4><ul>
<li>models.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line">    ut = models.ForeignKey(to=<span class="string">&#x27;UserType&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserType</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    type_name = models.CharField(max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>views.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 1 创建</span></span><br><span class="line">    <span class="comment"># 创建数据方法一</span></span><br><span class="line">    models.UserInfo.objects.create(name=<span class="string">&#x27;root&#x27;</span>, ut_id=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 创建数据方法二</span></span><br><span class="line">    obj = models.UserInfo(name=<span class="string">&#x27;root&#x27;</span>, ut_id=<span class="number">2</span>)</span><br><span class="line">    obj.save()</span><br><span class="line">    <span class="comment"># 创建数据库方法三(传入字典必须在字典前加两个星号)</span></span><br><span class="line">    dic = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;ut_id&#x27;</span>: <span class="number">2</span>&#125;</span><br><span class="line">    models.UserInfo.objects.create(**dic)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 删除</span></span><br><span class="line">    <span class="comment"># models.UserInfo.objects.all().delete()  # 删除所有</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;root&#x27;</span>).delete()  <span class="comment"># 删除指定</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 更新</span></span><br><span class="line">    <span class="comment"># models.UserInfo.objects.all().update(ut_id=1)</span></span><br><span class="line">    <span class="comment"># models.UserInfo.objects.filter(name=&#x27;zhangsan&#x27;).update(ut_id=4)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.1 正向查找 user_obj.ut.type_name</span></span><br><span class="line">    print( models.UserInfo.objects.get(name=<span class="string">&#x27;zhangsan&#x27;</span>).ut.type_name )</span><br><span class="line">    print( models.UserInfo.objects.<span class="built_in">filter</span>(ut__type_name=<span class="string">&#x27;student&#x27;</span>) )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.2 反向查找 type_obj.userinfo_set.all()</span></span><br><span class="line">    print( models.UserType.objects.get(type_name=<span class="string">&#x27;student&#x27;</span>).userinfo_set.<span class="built_in">all</span>() )</span><br><span class="line">    print( models.UserType.objects.get(type_name=<span class="string">&#x27;student&#x27;</span>).userinfo_set.<span class="built_in">filter</span>(name=<span class="string">&#x27;zhangsan&#x27;</span>) )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">views.py</span><br></pre></td></tr></table></figure>

<h4 id="49-2-一对多更多查询"><a href="#49-2-一对多更多查询" class="headerlink" title="49.2 一对多更多查询"></a>49.2 一对多更多查询</h4><ul>
<li>一对多创建表</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserType</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    user_type_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.user_type_name            <span class="comment">#只有加上这个，Django admin才会显示表名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    pwd = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    ut = models.ForeignKey(</span><br><span class="line">        to=<span class="string">&#x27;UserType&#x27;</span>,</span><br><span class="line">        to_field=<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1、反向操作时，使用的连接前缀，用于替换【表名】</span></span><br><span class="line">        <span class="comment"># 如： models.UserGroup.objects.filter(a__字段名=1).values(&#x27;a__字段名&#x27;)</span></span><br><span class="line">        related_query_name=<span class="string">&#x27;a&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">#2、反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.b_set.all()</span></span><br><span class="line">        <span class="comment"># 使用时查找报错</span></span><br><span class="line">        <span class="comment"># related_name=&#x27;b&#x27;,</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li>一对多正向反向查找</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 1 正向查找</span></span><br><span class="line">    <span class="comment">#1.1 正向查找user表用户名</span></span><br><span class="line">    print(models.User.objects.get(username=<span class="string">&#x27;zhangsan&#x27;</span>).username)           <span class="comment"># zhangsan</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#1.2 正向跨表查找用户类型</span></span><br><span class="line">    print(models.User.objects.get(username=<span class="string">&#x27;zhangsan&#x27;</span>).ut.user_type_name)  <span class="comment"># student</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#1.3 双下划线正向跨表正向查找</span></span><br><span class="line">    print( models.User.objects.<span class="built_in">all</span>().values(<span class="string">&#x27;ut__user_type_name&#x27;</span>,<span class="string">&#x27;username&#x27;</span>) )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2 反向查找</span></span><br><span class="line">    <span class="comment"># 2.1：【表名_set】，反向查找user表中用户类型为student 的所有用户</span></span><br><span class="line">    print( models.UserType.objects.get(user_type_name=<span class="string">&#x27;student&#x27;</span>).user_set.<span class="built_in">all</span>() )           <span class="comment"># [&lt;User: lisi&gt;, &lt;User: wangwu&gt;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.2：【a__字段名】反向查找user表中张三在UserType表中的类型：（[&lt;UserType: teacher&gt;]）</span></span><br><span class="line">    print( models.UserType.objects.<span class="built_in">filter</span>(a__username=<span class="string">&#x27;zhangsan&#x27;</span>) )                         <span class="comment"># student</span></span><br><span class="line">    <span class="comment"># 这里的a是user表的ForeignKey字段的参数：related_query_name=&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.3: 双下划线跨表反向查找</span></span><br><span class="line">    print( models.UserType.objects.<span class="built_in">all</span>().values(<span class="string">&#x27;a__username&#x27;</span>, <span class="string">&#x27;user_type_name&#x27;</span>) )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 自动创建User表和UserType表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    username = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    user_type = [&#123;&#x27;user_type_name&#x27;:&#x27;student&#x27;&#125;,&#123;&#x27;user_type_name&#x27;:&#x27;teacher&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for type_dic in user_type:</span></span><br><span class="line"><span class="string">        models.UserType.objects.create(**type_dic)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for user_dic in username:</span></span><br><span class="line"><span class="string">        models.User.objects.create(**user_dic)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>一对多使用values和values_list结合双下划线跨表查询</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 第一种：values-----获取的内部是字典  拿固定列数</span></span><br><span class="line">    <span class="comment"># 1.1 正向查找： 使用ForeignKey字段名ut结合双下划线查询</span></span><br><span class="line">    models.User.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ut__user_type_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 向查找： 使用ForeignKey的related_query_name=&#x27;a&#x27;,的字段</span></span><br><span class="line">    models.UserType.objects.<span class="built_in">all</span>().values(<span class="string">&#x27;user_type_name&#x27;</span>, <span class="string">&#x27;a__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第二种：values_list-----获取的是元组  拿固定列数</span></span><br><span class="line">    <span class="comment"># 1.1 正向查找： 使用ForeignKey字段名ut结合双下划线查询</span></span><br><span class="line">    stus = models.User.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values_list(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ut__user_type_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 反向查找： 使用ForeignKey的related_query_name=&#x27;a&#x27;,的字段</span></span><br><span class="line">    utype = models.UserType.objects.<span class="built_in">all</span>().values_list(<span class="string">&#x27;user_type_name&#x27;</span>, <span class="string">&#x27;a__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3 自动创建User表和UserType表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    username = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;ut_id&#x27;:&#x27;1&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    user_type = [&#123;&#x27;user_type_name&#x27;:&#x27;student&#x27;&#125;,&#123;&#x27;user_type_name&#x27;:&#x27;teacher&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for type_dic in user_type:</span></span><br><span class="line"><span class="string">        models.UserType.objects.create(**type_dic)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for user_dic in username:</span></span><br><span class="line"><span class="string">        models.User.objects.create(**user_dic)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="50-Django-多对多表结构操作"><a href="#50-Django-多对多表结构操作" class="headerlink" title="50 Django 多对多表结构操作"></a>50 Django 多对多表结构操作</h3><h4 id="50-1-创建并操作多对多表"><a href="#50-1-创建并操作多对多表" class="headerlink" title="50.1 创建并操作多对多表"></a>50.1 创建并操作多对多表</h4><h5 id="50-1-1-m2m字段创建"><a href="#50-1-1-m2m字段创建" class="headerlink" title="50.1.1 m2m字段创建"></a>50.1.1 m2m字段创建</h5><ul>
<li>自己不创建第三张关系表，有m2m字段: 根据queryset对象增删改查（推荐）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span>(<span class="params">request</span>):</span></span><br><span class="line">    user_info_obj = models.UserInfo.objects.get(username=<span class="string">&#x27;zhangsan&#x27;</span>)</span><br><span class="line">    user_info_objs = models.UserInfo.objects.<span class="built_in">all</span>()</span><br><span class="line"></span><br><span class="line">    group_obj = models.UserGroup.objects.get(group_name=<span class="string">&#x27;group_python&#x27;</span>)</span><br><span class="line">    group_objs = models.UserGroup.objects.<span class="built_in">all</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加: 正向</span></span><br><span class="line">    group_obj.user_info.add(user_info_obj)</span><br><span class="line">    group_obj.user_info.add(*user_info_objs)</span><br><span class="line">    <span class="comment"># 删除：正向</span></span><br><span class="line">    group_obj.user_info.remove(user_info_obj)</span><br><span class="line">    group_obj.user_info.remove(*user_info_objs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加: 反向</span></span><br><span class="line">    user_info_obj.usergroup_set.add(group_obj)</span><br><span class="line">    user_info_obj.usergroup_set.add(*group_objs)</span><br><span class="line">    <span class="comment"># 删除：反向</span></span><br><span class="line">    user_info_obj.usergroup_set.remove(group_obj)</span><br><span class="line">    user_info_obj.usergroup_set.remove(*group_objs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找：正向</span></span><br><span class="line">    print(group_obj.user_info.<span class="built_in">all</span>())                                <span class="comment"># 查找group_python组中所有用户</span></span><br><span class="line">    print(group_obj.user_info.<span class="built_in">all</span>().<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>))</span><br><span class="line">    <span class="comment"># 查找：反向</span></span><br><span class="line">    print(user_info_obj.usergroup_set.<span class="built_in">all</span>())                        <span class="comment"># 查找用户zhangsan属于那些组</span></span><br><span class="line">    print(user_info_obj.usergroup_set.<span class="built_in">all</span>().<span class="built_in">filter</span>(group_name=<span class="string">&#x27;group_python&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 双下划线 正向、反向查找</span></span><br><span class="line">    <span class="comment"># 正向：从用户组表中查找zhangsan属于哪个用户组：[&lt;UserGroup: group_python&gt;]</span></span><br><span class="line">    print( models.UserGroup.objects.<span class="built_in">filter</span>(user_info__username=<span class="string">&#x27;zhangsan&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向：从用户表中查询group_python组中有哪些用户：related_query_name=&#x27;m2m&#x27;</span></span><br><span class="line">    print( models.UserInfo.objects.<span class="built_in">filter</span>(m2m__group_name=<span class="string">&#x27;group_python&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建UserInfo表和UserGroup表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    user_list = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;&#125;,]</span></span><br><span class="line"><span class="string">    group_list = [&#123;&#x27;group_name&#x27;:&#x27;group_python&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_linux&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_mysql&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for c in user_list:</span></span><br><span class="line"><span class="string">        models.UserInfo.objects.create(**c)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for l in group_list:</span></span><br><span class="line"><span class="string">        models.UserGroup.objects.create(**l)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="50-1-2-手动创建第三张表"><a href="#50-1-2-手动创建第三张表" class="headerlink" title="50.1.2 手动创建第三张表"></a>50.1.2 手动创建第三张表</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#表1：主机表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Host</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    hostname = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#表2：应用表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#表3：自定义第三张关联表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HostToApp</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    hobj = models.ForeignKey(to=<span class="string">&quot;Host&quot;</span>,to_field=<span class="string">&quot;nid&quot;</span>)</span><br><span class="line">    aobj = models.ForeignKey(to=<span class="string">&#x27;Application&#x27;</span>,to_field=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向第三张表插入数据，建立多对多外键关联</span></span><br><span class="line">HostToApp.objects.create(hobj_id=<span class="number">1</span>,aobj_id=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h5 id="50-1-3-m2m创建（id查询）"><a href="#50-1-3-m2m创建（id查询）" class="headerlink" title="50.1.3 m2m创建（id查询）"></a>50.1.3 m2m创建（id查询）</h5><ul>
<li>自己不创建第三张关系表，有m2m字段，根据数字id增删改查</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Host</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    hostname = models.CharField(max_length=<span class="number">32</span>,db_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    group_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    m2m = models.ManyToManyField(<span class="string">&quot;Host&quot;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<ul>
<li>查询</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 使用间接方法对第三张表操作</span></span><br><span class="line">    obj = models.Group.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1、添加</span></span><br><span class="line">    obj.m2m.add(<span class="number">1</span>)           <span class="comment"># 在第三张表中增加一个条目(1,1)</span></span><br><span class="line">    obj.m2m.add(<span class="number">2</span>, <span class="number">3</span>)        <span class="comment"># 在第三张表中增加条目（1,2）（1,3）两条关系</span></span><br><span class="line">    obj.m2m.add(*[<span class="number">1</span>,<span class="number">3</span>])        <span class="comment"># 在第三张表中增加条目（1,2）（1,3）两条关系</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2、删除</span></span><br><span class="line">    obj.m2m.remove(<span class="number">1</span>)             <span class="comment"># 删除第三张表中的（1,1）条目</span></span><br><span class="line">    obj.m2m.remove(<span class="number">2</span>, <span class="number">3</span>)          <span class="comment"># 删除第三张表中的（1,2）（1,3）条目</span></span><br><span class="line">    obj.m2m.remove(*[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])    <span class="comment"># 删除第三张表中的（1,1）（1,2）（1,3）条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3、清空</span></span><br><span class="line">    obj.m2m.clear()                 <span class="comment"># 删除第三张表中application条目等于1的所有条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4 更新</span></span><br><span class="line">    obj.m2m.<span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>,])             <span class="comment"># 第三张表中会删除所有条目，然后创建（1,1）（1,2）条目</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5 查找</span></span><br><span class="line">    print( obj.m2m.<span class="built_in">all</span>() )           <span class="comment"># 等价于 models.UserInfo.objects.all()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6 反向查找： 双下划线</span></span><br><span class="line">    hosts = models.Group.objects.<span class="built_in">filter</span>(m2m__id=<span class="number">1</span>)         <span class="comment"># 在Host表中id=1的主机同时属于那些组</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建Host表和Group表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    hostname = [&#123;&#x27;hostname&#x27;:&#x27;zhangsan&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;hostname&#x27;:&#x27;lisi&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;hostname&#x27;:&#x27;wangwu&#x27;&#125;,]</span></span><br><span class="line"><span class="string">    group_name = [&#123;&#x27;group_name&#x27;:&#x27;DBA&#x27;&#125;,&#123;&#x27;group_name&#x27;:&#x27;public&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for h in hostname:</span></span><br><span class="line"><span class="string">        models.Host.objects.create(**h)</span></span><br><span class="line"><span class="string">    for u in group_name:</span></span><br><span class="line"><span class="string">        models.Group.objects.create(**u)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="50-2-values和values-list结合双下划线跨表查询"><a href="#50-2-values和values-list结合双下划线跨表查询" class="headerlink" title="50.2 values和values_list结合双下划线跨表查询"></a>50.2 values和values_list结合双下划线跨表查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orm</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 第一种：values-----获取的内部是字典,拿固定列数</span></span><br><span class="line">    <span class="comment"># 1.1 正向查找： 使用ManyToManyField字段名user_info结合双下划线查询</span></span><br><span class="line">    models.UserGroup.objects.<span class="built_in">filter</span>(group_name=<span class="string">&#x27;group_python&#x27;</span>).values(<span class="string">&#x27;group_name&#x27;</span>, <span class="string">&#x27;user_info__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 反向查找： 使用ManyToManyField的related_query_name=&#x27;m2m&#x27;,的字段</span></span><br><span class="line">    models.UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;m2m__group_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第二种：values_list-----获取的是元组  拿固定列数</span></span><br><span class="line">    <span class="comment"># 2.1 正向查找： 使用ManyToManyField字段名user_info结合双下划线查询</span></span><br><span class="line">    models.UserGroup.objects.<span class="built_in">filter</span>(group_name=<span class="string">&#x27;group_python&#x27;</span>).values_list(<span class="string">&#x27;group_name&#x27;</span>, <span class="string">&#x27;user_info__username&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.2 反向查找： 使用ManyToManyField的related_query_name=&#x27;m2m&#x27;,的字段</span></span><br><span class="line">    lesson = models.UserInfo.objects.<span class="built_in">filter</span>(username=<span class="string">&#x27;zhangsan&#x27;</span>).values_list(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;m2m__group_name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自动创建UserInfo表和UserGroup表中的数据</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    # user_info_obj = models.UserInfo.objects.get(username=&#x27;lisi&#x27;)</span></span><br><span class="line"><span class="string">    # user_info_objs = models.UserInfo.objects.all()</span></span><br><span class="line"><span class="string">    #</span></span><br><span class="line"><span class="string">    # group_obj = models.UserGroup.objects.get(group_name=&#x27;group_python&#x27;)</span></span><br><span class="line"><span class="string">    # group_objs = models.UserGroup.objects.all()</span></span><br><span class="line"><span class="string">    #</span></span><br><span class="line"><span class="string">    # group_obj.user_info.add(*user_info_objs)</span></span><br><span class="line"><span class="string">    # user_info_obj.usergroup_set.add(*group_objs)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    user_list = [&#123;&#x27;username&#x27;:&#x27;zhangsan&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;lisi&#x27;&#125;,</span></span><br><span class="line"><span class="string">                &#123;&#x27;username&#x27;:&#x27;wangwu&#x27;&#125;,]</span></span><br><span class="line"><span class="string">    group_list = [&#123;&#x27;group_name&#x27;:&#x27;group_python&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_linux&#x27;&#125;,</span></span><br><span class="line"><span class="string">               &#123;&#x27;group_name&#x27;:&#x27;group_mysql&#x27;&#125;,]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for c in user_list:</span></span><br><span class="line"><span class="string">        models.UserInfo.objects.create(**c)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for l in group_list:</span></span><br><span class="line"><span class="string">        models.UserGroup.objects.create(**l)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;orm&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="50-3-多对多时ManyToManyField可以添加的参数"><a href="#50-3-多对多时ManyToManyField可以添加的参数" class="headerlink" title="50.3 多对多时ManyToManyField可以添加的参数"></a>50.3 多对多时ManyToManyField可以添加的参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、to,                        <span class="comment"># 要进行关联的表名</span></span><br><span class="line"><span class="number">2</span>、related_name=<span class="literal">None</span>,         <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】如： obj.表名_set.all()</span></span><br><span class="line"><span class="number">3</span>、related_query_name=<span class="literal">None</span>,   <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】     </span></span><br><span class="line">                              <span class="comment"># 如： models.UserGroup.objects.filter(表名__字段名=1).values(&#x27;表名__字段名&#x27;)</span></span><br><span class="line"><span class="number">4</span>、limit_choices_to=<span class="literal">None</span>,     <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></span><br><span class="line">                              <span class="comment"># - limit_choices_to=&#123;&#x27;nid__gt&#x27;: 5&#125;</span></span><br><span class="line"><span class="number">5</span>、symmetrical=<span class="literal">None</span>,          <span class="comment"># 用于多对多自关联，symmetrical用于指定内部是否创建反向操作字段</span></span><br><span class="line"><span class="number">6</span>、through=<span class="literal">None</span>,              <span class="comment"># 自定义第三张表时，使用字段用于指定关系表</span></span><br><span class="line"><span class="number">7</span>、through_fields=<span class="literal">None</span>,       <span class="comment"># 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span></span><br><span class="line"><span class="number">8</span>、db_constraint=<span class="literal">True</span>,        <span class="comment"># 是否在数据库中创建外键约束</span></span><br><span class="line">   db_table=<span class="literal">None</span>,             <span class="comment"># 默认创建第三张表时，数据库中表的名称</span></span><br></pre></td></tr></table></figure>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/myhexo/about" rel="external nofollow noreferrer">狐 狸 大 大</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://fox-loves-sugar.github.io/myhexo/myhexo/2019/02/01/date1215s/">https://fox-loves-sugar.github.io/myhexo/myhexo/2019/02/01/date1215s/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/myhexo/about" target="_blank">狐 狸 大 大</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/myhexo/tags/docker/">
                                    <span class="chip bg-color">docker</span>
                                </a>
                            
                                <a href="/myhexo/tags/python/">
                                    <span class="chip bg-color">python</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/myhexo/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/myhexo/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/myhexo/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/myhexo/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/myhexo/2019/03/01/date1215ss/">
                    <div class="card-image">
                        
                        
                        <img src="/myhexo/medias/featureimages/5.jpg" class="responsive-img" alt="python垃圾回收机制">
                        
                        <span class="card-title">python垃圾回收机制</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2019-03-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            狐 狸 大 大
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/myhexo/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/myhexo/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/">
                        <span class="chip bg-color">垃圾回收机制</span>
                    </a>
                    
                    <a href="/myhexo/tags/%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/">
                        <span class="chip bg-color">引用计数</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                本篇&nbsp;<i class="far fa-dot-circle"></i>
            </div>
            <div class="card">
                <a href="/myhexo/2019/02/01/date1215s/">
                    <div class="card-image">
                        
                        
                        <img src="/myhexo/medias/featureimages/0.jpg" class="responsive-img" alt="常记Fifty">
                        
                        <span class="card-title">常记Fifty</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2019-02-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            狐 狸 大 大
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/myhexo/tags/docker/">
                        <span class="chip bg-color">docker</span>
                    </a>
                    
                    <a href="/myhexo/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/myhexo/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->


<!-- 代码块复制 -->


<!-- 代码块收缩 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/myhexo/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/myhexo/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/myhexo/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/myhexo/about" target="_blank">狐 狸 大 大</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/fox-loves-sugar" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:171767289@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=171767289" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 171767289" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/myhexo/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/myhexo/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/myhexo/libs/materialize/materialize.min.js"></script>
    <script src="/myhexo/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/myhexo/libs/aos/aos.js"></script>
    <script src="/myhexo/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/myhexo/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/myhexo/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/myhexo/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/myhexo/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/myhexo/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
